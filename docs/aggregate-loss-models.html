<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course</title>
  <meta name="description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  <meta name="github-repo" content="https://github.com/OpenActTextDev/LDAShortCourse1" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Aggregate Loss Models | Loss Data Analytics: Short Course" />
  
  <meta name="twitter:description" content="This is an interactive, online, freely available short course. It will contain many interactive objects (quizzes, computer demonstrations, interactive graphs, video, and the like) to promote deeper learning." />
  

<meta name="author" content="A short course authored by the Actuarial Community" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-selection-and-estimation.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<!-- Mathjax -->
<script type='text/x-mathjax-config'>
		MathJax.Hub.Config({
			extensions: ['tex2jax.js'],
			jax: ['input/TeX', 'output/HTML-CSS'],
			tex2jax: {
				inlineMath: [ ['$','$'], ['\\(','\\)'] ],
				displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
				processEscapes: true
			},
			'HTML-CSS': { availableFonts: ['TeX'] }
		});
</script>

<!-- The following code is for the quizzes -->
<script src="https://surveyjs.azureedge.net/1.0.50/survey.jquery.js"></script>
<link href="https://surveyjs.azureedge.net/1.0.50/survey.css" type="text/css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.6.4/showdown.min.js"></script>  

<script>
function markdownConverterEWF() {  
//Create showdown markdown converter
var converter = new showdown.Converter();
converter.setOption('ghCompatibleHeaderId', true);
survey
    .onTextMarkdown
    .add(function (survey, options) {
        //convert the mardown text to html
        var str = converter.makeHtml(options.text);
        //remove root paragraphs <p></p>
        str = str.substring(3);
        str = str.substring(0, str.length - 4);
        //set html
        options.html = str;
         MathJax.Hub.Queue(['Typeset',MathJax.Hub, 'options']);
    });  
};
// Quiz Header info
const jsonHeader = { 
    showProgressBar: "bottom",
    showTimerPanel: "none",
    maxTimeToFinishPage: 10000,
    maxTimeToFinish: 25000,
    firstPageIsStarted: true,
    startSurveyText: "Start Quiz" //,
//    title: "Does This Make Sense?"
}
// One and Two question quizzes
function jsonSummary1EWF(json) {  
let jsonEnd1 = { 
completedHtml: 
json["pages"][1]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][1]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][1]["questions"][0]["correctAnswer"]
};  
return jsonEnd1;
};


function jsonSummary2EWF(json) {  
let jsonEnd2 = { 
completedHtml: 
json["pages"][1]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][1]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][1]["questions"][0]["correctAnswer"]
+"<br>"+
json["pages"][2]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][2]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][2]["questions"][0]["correctAnswer"]
};  
return jsonEnd2;
};

// Three, four, and five question quizzes
function jsonSummary3EWF(json) {  
let jsonEnd3 = { 
completedHtml: 
json["pages"][1]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][1]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][1]["questions"][0]["correctAnswer"]
+"<br>"+
json["pages"][2]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][2]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][2]["questions"][0]["correctAnswer"]
+"<br>"+
json["pages"][3]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][3]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][3]["questions"][0]["correctAnswer"]
};  
return jsonEnd3;
};

function jsonSummary4EWF(json) {  
jsonEnd4 = jsonSummary3EWF(json);
jsonEnd4.completedHtml = jsonEnd4.completedHtml +  
"<br>"+
json["pages"][4]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][4]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][4]["questions"][0]["correctAnswer"]
;  
return jsonEnd4;
};

function jsonSummary5EWF(json) {  
jsonEnd5 = jsonSummary4EWF(json);
jsonEnd5.completedHtml = jsonEnd5.completedHtml +  
"<br>"+
json["pages"][5]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][5]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][5]["questions"][0]["correctAnswer"]
;  
return jsonEnd5;
};

function jsonSummary6EWF(json) {  
jsonEnd6 = jsonSummary5EWF(json);
jsonEnd6.completedHtml = jsonEnd6.completedHtml +  
"<br>"+
json["pages"][6]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][6]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][6]["questions"][0]["correctAnswer"]
;  
return jsonEnd6;
};

function jsonSummary7EWF(json) {  
jsonEnd7 = jsonSummary6EWF(json);
jsonEnd7.completedHtml = jsonEnd7.completedHtml +  
"<br>"+
json["pages"][7]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][7]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][7]["questions"][0]["correctAnswer"]
;  
return jsonEnd7;
};

function jsonSummary8EWF(json) {  
jsonEnd8 = jsonSummary7EWF(json);
jsonEnd8.completedHtml = jsonEnd8.completedHtml +  
"<br>"+
json["pages"][8]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][8]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][8]["questions"][0]["correctAnswer"]
;  
return jsonEnd8;
};

function jsonSummary9EWF(json) {  
jsonEnd9 = jsonSummary8EWF(json);
jsonEnd9.completedHtml = jsonEnd9.completedHtml +  
"<br>"+
json["pages"][9]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][9]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][9]["questions"][0]["correctAnswer"]
;  
return jsonEnd9;
};


function jsonSummary10EWF(json) {  
jsonEnd10 = jsonSummary9EWF(json);
jsonEnd10.completedHtml = jsonEnd10.completedHtml +  
"<br>"+
json["pages"][10]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][10]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][10]["questions"][0]["correctAnswer"]
;  
return jsonEnd10;
};


function jsonSummary11EWF(json) {  
jsonEnd11 = jsonSummary10EWF(json);
jsonEnd11.completedHtml = jsonEnd11.completedHtml +  
"<br>"+
json["pages"][11]["questions"][0]["name"]+ "<br>"+
"<i>Question: </i>"+json["pages"][11]["questions"][0]["title"]+"<br>"+
"<i>Answer: </i>"+json["pages"][11]["questions"][0]["correctAnswer"]
;  
return jsonEnd11;
};



</script>  
<!-- This completes the code for the quizzes -->


<!-- Various toggle functions used throughout --> 
<script language="javascript">
function toggle(id1,id2) {
	var ele = document.getElementById(id1); var text = document.getElementById(id2);
	if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Solution";}
		else {ele.style.display = "block"; text.innerHTML = "Hide Solution";}}
function togglecode(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show R Code";}
      else {ele.style.display = "block"; text.innerHTML = "Hide R Code";}}
function toggleEX(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Example";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Example";}}
function toggleTheory(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Theory";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Theory";}}
function toggleQuiz(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Quiz Solution";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Quiz Solution";}}      
</script>

<!-- A few functions for revealing definitions -->
<script language="javascript">
<!--   $( function() {
    $("#tabs").tabs();
  } ); -->

$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});

$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>

<script language="javascript">
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125587869-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125587869-1');
</script>
<script language="javascript">
function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}

// Get the element with id="defaultOpen" and click on it
document.getElementById("defaultOpen").click();
</script>

<script language="javascript">
function toggle(id1,id2) {
	var ele = document.getElementById(id1); var text = document.getElementById(id2);
	if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Solution";}
		else {ele.style.display = "block"; text.innerHTML = "Hide Solution";}}
</script>

<script language="javascript">
function togglecode(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show R Code";}
      else {ele.style.display = "block"; text.innerHTML = "Hide R Code";}}
</script>
<script language="javascript">
function toggleEX(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Example";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Example";}}
</script>
<script language="javascript">
function toggleTheory(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Theory";}
      else {ele.style.display = "block"; text.innerHTML = "Hide Theory";}}
</script>

<script language="javascript">
function toggleDet(id1,id2) {
   var ele = document.getElementById(id1); var text = document.getElementById(id2);
   if (ele.style.display == "block") {ele.style.display = "none"; text.innerHTML = "Show Details";}
      else {ele.style.display = "block"; text.innerHTML = "Hide  Details";}}
</script>

<script language="javascript">
$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
});
</script>


<script>
$(document).ready(function(){
    $('[data-toggle="popover"]').popover(); 
});
</script>


<script src=https://cdn.datacamp.com/datacamp-light-latest.min.js></script>


<style>
/* Rearrange console label */
.datacamp-exercise ol li, .datacamp-exercise ul li {
  margin-bottom: 0em !important;
}

/* Remove bullet marker */
.datacamp-exercise ol li::before, .datacamp-exercise ul li::before {
  content: '' !important;
}
</style>


<script language="javascript">
var submitAnswer = function() {

  var radios = document.getElementsByName('choice');
  var val= "";
  for (var i = 0, length = radios.length; i < length; i++) {
      if (radios[i].checked) {
         val = radios[i].value; 
         break;
       }
  }
  
  if (val == "" ) {
    alert('please select choice answer');
  } else if ( val == "Correct" ) {
    alert('Answer is correct !');
  } else {
    alert('Answer is wrong');
  }
};
</script>





<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-125587869-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125587869-1');
</script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Loss Data Analytics: Short Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-loss-data-analytics"><i class="fa fa-check"></i>Why Loss Data Analytics?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i>Resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-navigate-this-tutorial"><i class="fa fa-check"></i>How to Navigate this Tutorial</a></li>
<li><a href="index.html#a-word-from-our-sponsor-astin-education-astin-academy">A word from our Sponsor: <br> Astin + Education = Astin Academy</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html"><i class="fa fa-check"></i><b>1</b> Introduction to Loss Data Analytics</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:Intro"><i class="fa fa-check"></i><b>1.1</b> Relevance of Analytics to Insurance Activities</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:PredModApps"><i class="fa fa-check"></i><b>1.2</b> Insurance Company Operations</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#Sec:LGPIF"><i class="fa fa-check"></i><b>1.3</b> Case Study: Property Fund Introduction</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-claim-frequency"><i class="fa fa-check"></i><b>1.3.1</b> Exercise. Claim Frequency</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#property-fund-claim-severity"><i class="fa fa-check"></i><b>1.4</b> Property Fund Claim Severity</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-exploring-claim-severities"><i class="fa fa-check"></i><b>1.4.1</b> Exercise. Exploring Claim Severities</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-skewness-of-the-claim-severity-distribution"><i class="fa fa-check"></i><b>1.4.2</b> Exercise. Skewness of the Claim Severity Distribution</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-claim-severity-by-year"><i class="fa fa-check"></i><b>1.4.3</b> Exercise. Claim Severity by Year</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#property-fund-rating-variables"><i class="fa fa-check"></i><b>1.5</b> Property Fund Rating Variables</a><ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-loss-data-analytics.html"><a href="introduction-to-loss-data-analytics.html#exercise.-claim-by-entity-type-fire-class-and-no-claim-credit"><i class="fa fa-check"></i><b>1.5.1</b> Exercise. Claim by Entity Type, Fire Class, and No Claim Credit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="frequency-modeling.html"><a href="frequency-modeling.html"><i class="fa fa-check"></i><b>2</b> Frequency Modeling</a><ul>
<li class="chapter" data-level="2.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#basic-frequency-distributions"><i class="fa fa-check"></i><b>2.1</b> Basic Frequency Distributions</a><ul>
<li class="chapter" data-level="2.1.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-representing-the-number-of-cyber-events-with-a-binomial-distribution"><i class="fa fa-check"></i><b>2.1.1</b> Exercise. Representing the Number of Cyber Events with a Binomial Distribution</a></li>
<li class="chapter" data-level="2.1.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-representing-the-number-of-cyber-events-with-a-poisson-distribution"><i class="fa fa-check"></i><b>2.1.2</b> Exercise. Representing the Number of Cyber Events with a Poisson Distribution</a></li>
<li class="chapter" data-level="2.1.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-comparing-basic-count-distributions"><i class="fa fa-check"></i><b>2.1.3</b> Exercise. Comparing Basic Count Distributions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#the-ab0-class"><i class="fa fa-check"></i><b>2.2</b> The (a,b,0) Class</a><ul>
<li class="chapter" data-level="2.2.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-determining-probabilities-recursively"><i class="fa fa-check"></i><b>2.2.1</b> Exercise. Determining Probabilities Recursively</a></li>
<li class="chapter" data-level="2.2.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-reverse-engineering-and-recursive-r-functions"><i class="fa fa-check"></i><b>2.2.2</b> Exercise. Reverse Engineering and Recursive <code>R</code> Functions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#mixture-distributions"><i class="fa fa-check"></i><b>2.3</b> Mixture Distributions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-mixtures-of-workers-compensation-claims"><i class="fa fa-check"></i><b>2.3.1</b> Exercise. Mixtures of Workers’ Compensation Claims</a></li>
<li class="chapter" data-level="2.3.2" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-finite-number-of-mixture-distributions"><i class="fa fa-check"></i><b>2.3.2</b> Exercise. Finite Number of Mixture Distributions</a></li>
<li class="chapter" data-level="2.3.3" data-path="frequency-modeling.html"><a href="frequency-modeling.html#exercise.-gamma-mixture-of-poissons"><i class="fa fa-check"></i><b>2.3.3</b> Exercise. Gamma Mixture of Poissons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html"><i class="fa fa-check"></i><b>3</b> Modeling Loss Severity</a><ul>
<li class="chapter" data-level="3.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#methods-of-creating-new-distributions"><i class="fa fa-check"></i><b>3.1</b> Methods of Creating New Distributions</a><ul>
<li class="chapter" data-level="3.1.1" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#exercise.-claim-frequency-1"><i class="fa fa-check"></i><b>3.1.1</b> Exercise. Claim Frequency</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeling-loss-severity.html"><a href="modeling-loss-severity.html#coverage-modifications"><i class="fa fa-check"></i><b>3.2</b> Coverage Modifications</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html"><i class="fa fa-check"></i><b>4</b> Model Selection and Estimation</a><ul>
<li class="chapter" data-level="4.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#nonparametric-inference"><i class="fa fa-check"></i><b>4.1</b> Nonparametric Inference</a><ul>
<li class="chapter" data-level="4.1.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-empirical-distribution-function-and-quartiles-percentiles-and-quantiles"><i class="fa fa-check"></i><b>4.1.1</b> Exercise. Empirical Distribution Function and Quartiles, Percentiles and Quantiles</a></li>
<li class="chapter" data-level="4.1.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-density-estimators"><i class="fa fa-check"></i><b>4.1.2</b> Exercise. Density Estimators</a></li>
<li class="chapter" data-level="4.1.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-claim-frequency-2"><i class="fa fa-check"></i><b>4.1.3</b> Exercise. Claim Frequency</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#tools-for-model-selection"><i class="fa fa-check"></i><b>4.2</b> Tools for Model Selection</a><ul>
<li class="chapter" data-level="4.2.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-probability-probability-pp-plot"><i class="fa fa-check"></i><b>4.2.1</b> Exercise. Probability-Probability (PP) plot</a></li>
<li class="chapter" data-level="4.2.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-quantile-quantile-qq-plot"><i class="fa fa-check"></i><b>4.2.2</b> Exercise. Quantile-Quantile (QQ) plot</a></li>
<li class="chapter" data-level="4.2.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-kolmogorov-smirnov-test"><i class="fa fa-check"></i><b>4.2.3</b> Exercise. Kolmogorov-Smirnov test</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#model-selection-likelihood-ratio-tests-and-goodness-of-fit"><i class="fa fa-check"></i><b>4.3</b> Model Selection: Likelihood Ratio Tests and Goodness of Fit</a></li>
<li class="chapter" data-level="4.4" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#estimation-using-modified-data-nonparametric-approach"><i class="fa fa-check"></i><b>4.4</b> Estimation using Modified Data: Nonparametric Approach</a><ul>
<li class="chapter" data-level="4.4.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-nonparametric-estimation-using-modified-data"><i class="fa fa-check"></i><b>4.4.1</b> Exercise. Nonparametric Estimation using Modified Data</a></li>
<li class="chapter" data-level="4.4.2" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#exercise.-nonparametric-estimation-using-modified-data-ii"><i class="fa fa-check"></i><b>4.4.2</b> Exercise. Nonparametric Estimation using Modified Data II</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#estimation-using-modified-data-parametric-approach"><i class="fa fa-check"></i><b>4.5</b> Estimation using Modified Data: Parametric Approach</a></li>
<li class="chapter" data-level="4.6" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#bayesian-inference"><i class="fa fa-check"></i><b>4.6</b> Bayesian Inference</a><ul>
<li class="chapter" data-level="4.6.1" data-path="model-selection-and-estimation.html"><a href="model-selection-and-estimation.html#visualizing-bayesian-methods"><i class="fa fa-check"></i><b>4.6.1</b> Visualizing Bayesian Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html"><i class="fa fa-check"></i><b>5</b> Aggregate Loss Models</a><ul>
<li class="chapter" data-level="5.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#individual-risk-model"><i class="fa fa-check"></i><b>5.2</b> Individual Risk Model</a><ul>
<li class="chapter" data-level="5.2.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-individual-risk-model-i"><i class="fa fa-check"></i><b>5.2.1</b> Exercise. Individual Risk Model I</a></li>
<li class="chapter" data-level="5.2.2" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-individual-risk-model-ii"><i class="fa fa-check"></i><b>5.2.2</b> Exercise. Individual Risk Model II</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#collective-risk-model---part-i"><i class="fa fa-check"></i><b>5.3</b> Collective Risk Model - Part I</a><ul>
<li class="chapter" data-level="5.3.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-collective-risk-model-i"><i class="fa fa-check"></i><b>5.3.1</b> Exercise. Collective Risk Model I</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#collective-risk-model---part-ii"><i class="fa fa-check"></i><b>5.4</b> Collective Risk Model - Part II</a><ul>
<li class="chapter" data-level="5.4.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-collective-risk-model-ii"><i class="fa fa-check"></i><b>5.4.1</b> Exercise. Collective Risk Model II</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#tweedie-distribution"><i class="fa fa-check"></i><b>5.5</b> Tweedie Distribution</a><ul>
<li class="chapter" data-level="5.5.1" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#exercise.-tweedie-distribution"><i class="fa fa-check"></i><b>5.5.1</b> Exercise. Tweedie Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="aggregate-loss-models.html"><a href="aggregate-loss-models.html#effects-of-coverage-modifications"><i class="fa fa-check"></i><b>5.6</b> Effects of Coverage Modifications</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/OpenActTextDev/LDACourse1/" target="blank">LDA Short Course on GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Loss Data Analytics: Short Course</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aggregate-loss-models" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Aggregate Loss Models</h1>
<p><strong>Draft - Chapter Not Yet Complete</strong></p>
<p><br></p>
<p><strong>Chapter description</strong></p>
<p>This chapter introduces probability models for describing the aggregate (total) claims that arise from a portfolio of insurance contracts. We present two standard modeling approaches, the individual risk model and the collective risk model. Further, we discuss strategies for computing the distribution of the aggregate claims, including exact methods for special cases, recursion, and simulation. Finally, we examine the effects of individual policy modifications such as deductibles, coinsurance, and inflation, on the frequency and severity distributions, and thus on the aggregate loss distribution.</p>
<div class="blackbox">
<ul>
<li>Although not needed to go through the tutorials, some users may wish to download the overheads used in the videos. <button download><a href="https://raw.githubusercontent.com/OpenActTextDev/LDACourse1/main/LDA1.Overheads/LDA1.Chap5.pdf">Download Chapter Five overheads as a .pdf file.</a></button></li>
<li>By watching the videos and working through the tutorial exercises, you will get an appreciation for aggregate loss models. For a deeper dive, see the corresponding chapter in the textbook, <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html">Chapter Five of <em>Loss Data Analytics</em></a>.</li>
</ul>
</div>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Record aggregated losses from an insurance system</li>
<li>Identify actuarial applications of aggregate loss models</li>
</ul>
<hr />
<div id="video-introduction-to-aggregate-loss-models" class="section level4 unnumbered">
<h4>Video: Introduction to Aggregate Loss Models</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_bock2cl4&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_1bqvxhby" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-introduction-to-aggregate-loss-models-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Introduction to Aggregate Loss Models (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect51A')">A. Basic Terminology</button>
<button class="tablinks" onclick="openTab(event, 'Sect51B')">B. Goal</button>
<button class="tablinks" onclick="openTab(event, 'Sect51C')">C. Models</button>
<button class="tablinks" onclick="openTab(event, 'Sect51D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect51E')">E. Applications</button>
</div>
<div id="Sect51A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=3" width="100%" height="400"> </iframe>
</div>
<div id="Sect51B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=4" width="100%" height="400"> </iframe>
</div>
<div id="Sect51C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=5" width="100%" height="400"> </iframe>
</div>
<div id="Sect51D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=7" width="100%" height="400"> </iframe>
</div>
<div id="Sect51E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=8" width="100%" height="400"> </iframe>
</div>
</div>
</div>
<div id="individual-risk-model" class="section level2">
<h2><span class="header-section-number">5.2</span> Individual Risk Model</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Build an individual risk model for a portfolio of insurance contracts</li>
<li>Apply individual risk model to life and nonlife insurance</li>
<li>Compute the distribution of aggregate losses from an individual risk model</li>
</ul>
<hr />
<div id="video-individual-risk-model" class="section level4 unnumbered">
<h4>Video: Individual Risk Model</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_ndjyp3ql&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_ivcxtqyq" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-individual-risk-model-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Individual Risk Model (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect52A')">A. Individual Risk Model</button>
<button class="tablinks" onclick="openTab(event, 'Sect52B')">B. Applications</button>
<button class="tablinks" onclick="openTab(event, 'Sect52C')">C. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect52D')">D. Aggregate Loss Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect52E')">E. R Example #1</button>
<button class="tablinks" onclick="openTab(event, 'Sect52F')">F. R Example #2</button>
</div>
<div id="Sect52A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=10" width="100%" height="400"> </iframe>
</div>
<div id="Sect52B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=11" width="100%" height="400"> </iframe>
</div>
<div id="Sect52C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=13" width="100%" height="400"> </iframe>
</div>
<div id="Sect52D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=15" width="100%" height="400"> </iframe>
</div>
<div id="Sect52E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=16" width="100%" height="400"> </iframe>
</div>
<div id="Sect52F" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=17" width="100%" height="400"> </iframe>
</div>
</div>
<div id="exercise.-individual-risk-model-i" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Exercise. Individual Risk Model I</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we will revisit <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html">Example 5.2.1</a> in the textbook and generate using <em>simulation</em> in <code>R</code>. Even though we will `officially’ start to work with simulation since Chapter 6, this exercise provides you an opportunity to taste a flavor of simulation with an example.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/Binomial">rbinom()</a> to simulate the number of claims that follow <em>binomial</em> distribution. For reproducibility of results, fix the random seed as ‘1000’ and generate 10,000 observations of claim frequencies for each group of policies.</li>
<li>Specify the size and probability when you simulate the number of claims with binomial distribution in each group of policies.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJzYW1wbGUiOiJzZXQuc2VlZChfX19fKSAgICAgXG5yICA8LSBfX19fICAgICAgICAgXG5xMSA8LSAwLjA1ICAgICAgICAgXG5xMiA8LSBfX19fICAgICAgICAgXG5uMSA8LSBfX19fICAgICAgICAgXG5uMiA8LSAyMDAgICAgICAgICAgXG5cbm4xIDwtIHJiaW5vbShyLCBzaXplPW4xLCBwcm9iPXExKSBcbm4yIDwtIHJiaW5vbShyLCBzaXplPV9fLCBwcm9iPV9fKSAiLCJzb2x1dGlvbiI6InNldC5zZWVkKDEwMDApICAgICAjIEZvciByZXByb2R1Y2liaWxpdHkgb2YgcmVzdWx0c1xuciAgPC0gMTAwMDAgICAgICAgICMgTnVtYmVyIG9mIG9ic2VydmF0aW9ucyB0byBzaW11bGF0ZSBmb3IgZWFjaCBwb2xpY3lcbnExIDwtIDAuMDUgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDFcbnEyIDwtIDAuMDYgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDJcbm4xIDwtIDEwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDEgcG9saWNpZXNcbm4yIDwtIDIwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDIgcG9saWNpZXNcblxuXG5uMSA8LSByYmlub20ociwgc2l6ZT1uMSwgcHJvYj1xMSkgIyBHZW5lcmF0ZSByPTEwMDAwIG9ic2VydmF0aW9ucyBvZiBOMSBmcm9tIEJpbm9taWFsXG5uMiA8LSByYmlub20ociwgc2l6ZT1uMiwgcHJvYj1xMikgIyBHZW5lcmF0ZSByPTEwMDAwIG9ic2VydmF0aW9ucyBvZiBOMiBmcm9tIEJpbm9taWFsIiwic2N0Ijoic3VjY2Vzc19tc2coXCJHb29kIGpvYiEgVGhpcyBleGVyY2lzZSBpcyBiYXNpY2FsbHkgYSByZWNhcGl0dWxhdGlvbiBvZiBDaGFwdGVyIDIgYnV0IHN0aWxsIHF1aXRlIGltcG9ydGFudCBhcyBvbmUgb2YgdGhlIGJ1aWxkaW5nIGJsb2NrcyBvZiBJbmRpdmlkdWFsIFJpc2sgTW9kZWxzLlwiKSIsImhpbnQiOiJOb3RlIHRoYXQgbnVtYmVyIG9mIHBvbGljaWVzIGFuZCBwcm9iYWJpbGl0eSBvZiBjbGFpbSBwZXIgcG9saWN5IGNvcnJlc3BvbmQgdG8gdGhlIHNpemUgYW5kIGluY2lkZW5jZSBwcm9iYWJpbGl0eSBpbiBhIGJpbm9taWFsIGRpc3RyaWJ1dGlvbiBmb3IgYSBjbGFpbSBmcmVxdWVuY3kgcmFuZG9tIHZhcmlhYmxlLCByZXNwZWN0aXZlbHkuIn0=
</div>
</div>
<div id="exercise.-individual-risk-model-ii" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Exercise. Individual Risk Model II</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we will revisit <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html">Example 5.2.1</a> in the textbook and reproduce the theoretical results for moments calculation in individual risk models using <em>simulation</em> in <code>R</code>. We use the simulated frequencies for each group of policies in Exercise 5.5.2.1 and continue to simulate compound losses in an individual risk model as elaborated in <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-AggLossModels.html#computing-the-aggregate-claims-distribution">Section 5.4.2</a>.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/Uniform">runif()</a> to claim amounts that follow <em>uniform</em> distribution for each group of policies.</li>
<li>Specify the parameters of uniform random variables, minimum and maximum values of claim amounts from each type of policies.</li>
<li>Initialize an empty vector of length <span class="math inline">\(r\)</span> to store <span class="math inline">\(r\)</span> observations of simulated <span class="math inline">\(S\)</span>. In each simulation, calculate <span class="math inline">\(j\)</span>th simulated aggregate loss and store it in <span class="math inline">\(j\)</span>th component of <span class="math inline">\(S\)</span> for <span class="math inline">\(j=1, \ldots, R\)</span>.</li>
<li>Compute mean and variance of <span class="math inline">\(S\)</span> by simulation using <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/mean">mean()</a> and <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/cor">var()</a>, and compare these values to their corresponding theoretical values, 2,800 and 600,467, respectively.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6InNldC5zZWVkKDEwMDApICAgICAjIEZvciByZXByb2R1Y2liaWxpdHkgb2YgcmVzdWx0c1xuciAgPC0gMTAwMDAgICAgICAgICMgTnVtYmVyIG9mIG9ic2VydmF0aW9ucyB0byBzaW11bGF0ZSBmb3IgZWFjaCBwb2xpY3lcbnExIDwtIDAuMDUgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDFcbnEyIDwtIDAuMDYgICAgICAgICAjIFByb2JhYmlsaXR5IG9mIGNsYWltIGZyb20gcG9saWN5IDJcbm4xIDwtIDEwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDEgcG9saWNpZXNcbm4yIDwtIDIwMCAgICAgICAgICAjIE51bWJlciBvZiB0eXBlIDIgcG9saWNpZXNcblxubjEgPC0gcmJpbm9tKHIsIHNpemU9bjEsIHByb2I9cTEpICMgR2VuZXJhdGUgcj0xMDAwMCBvYnNlcnZhdGlvbnMgb2YgTjEgZnJvbSBCaW5vbWlhbFxubjIgPC0gcmJpbm9tKHIsIHNpemU9bjIsIHByb2I9cTIpICMgR2VuZXJhdGUgcj0xMDAwMCBvYnNlcnZhdGlvbnMgb2YgTjIgZnJvbSBCaW5vbWlhbCIsInNhbXBsZSI6InNldC5zZWVkKDEwMDApICAgICBcbnIgIDwtIDEwMDAwICAgICAgICBcbm0xIDwtIDA7IE0xIDwtIF9fXyBcbm0yIDwtIF87IE0yIDwtIDMwMCBcblxuIyBuMTogR2VuZXJhdGVkIDEwMDAwIG9ic2VydmF0aW9ucyBvZiBjbGFpbSBmcmVxdWVuY3kgZnJvbSB0aGUgZmlyc3QgIGdyb3VwIG9mIHBvbGljaWVzIHdpdGggQmlub21pYWxcbiMgbjI6IEdlbmVyYXRlZCAxMDAwMCBvYnNlcnZhdGlvbnMgb2YgY2xhaW0gZnJlcXVlbmN5IGZyb20gdGhlIHNlY29uZCBncm91cCBvZiBwb2xpY2llcyB3aXRoIEJpbm9taWFsXG5cblMgPC0gcmVwKF9fLCByKSBcblxuZm9yKGogaW4gMTpyKSB7IFxuICB4MV9qIDwtIHJ1bmlmKG4xW2pdLCBtaW49bTEsIG1heD1fXylcbiAgeDJfaiA8LSBydW5pZihfX19fXywgbWluPV9fLCBtYXg9TTIpXG4gIFNbal0gPC0gc3VtKHgxX2opK3N1bShfX18pXG59XG5fX19fKFMpIFxudmFyKF8pICAiLCJzb2x1dGlvbiI6InNldC5zZWVkKDEwMDApICAgICAjIEZvciByZXByb2R1Y2liaWxpdHkgb2YgcmVzdWx0c1xuciAgPC0gMTAwMDAgICAgICAgICMgTnVtYmVyIG9mIG9ic2VydmF0aW9ucyB0byBzaW11bGF0ZSBmb3IgZWFjaCBwb2xpY3lcbm0xIDwtIDA7IE0xIDwtIDQwMCAjIFBhcmFtZXRlcnMgZm9yIHNldmVyaXR5IGRpc3RyaWJ1dGlvbiBYXzFcbm0yIDwtIDA7IE0yIDwtIDMwMCAjIFBhcmFtZXRlcnMgZm9yIHNldmVyaXR5IGRpc3RyaWJ1dGlvbiBYXzJcblxuIyBuMTogR2VuZXJhdGVkIDEwMDAwIG9ic2VydmF0aW9ucyBvZiBjbGFpbSBmcmVxdWVuY3kgZnJvbSB0aGUgZmlyc3QgIGdyb3VwIG9mIHBvbGljaWVzIHdpdGggQmlub21pYWxcbiMgbjI6IEdlbmVyYXRlZCAxMDAwMCBvYnNlcnZhdGlvbnMgb2YgY2xhaW0gZnJlcXVlbmN5IGZyb20gdGhlIHNlY29uZCBncm91cCBvZiBwb2xpY2llcyB3aXRoIEJpbm9taWFsXG5cblMgPC0gcmVwKE5BLCByKSAjIEluaXRpYWxpemUgYW4gZW1wdHkgdmVjdG9yIHRvIHN0b3JlIFMgb2JzZXJ2YXRpb25zXG5cblxuZm9yKGogaW4gMTpyKSB7IFxuICB4MV9qIDwtIHJ1bmlmKG4xW2pdLCBtaW49bTEsIG1heD1NMSlcbiAgeDJfaiA8LSBydW5pZihuMltqXSwgbWluPW0yLCBtYXg9TTIpXG4gIFNbal0gIDwtIHN1bSh4MV9qKStzdW0oeDJfaikgIyBDYWxjdWxhdGUganRoIHNpbXVsYXRlZCBhZ2dyZWdhdGUgbG9zcyBhbmQgc3RvcmUgaXQgYXQgU1tqXVxufVxuICBcbm1lYW4oUykgIyBDb21wYXJlIHRvIHRoZW9yZXRpY2FsIHZhbHVlIG9mIDIsODAwXG52YXIoUykgICMgQ29tcGFyZSB0byB0aGVvcmV0aWNhbCB2YWx1ZSBvZiA2MDAsNDY3Iiwic2N0Ijoic3VjY2Vzc19tc2coXCJHb29kIGpvYiEgTm90ZSB0aGF0IHNpbXVsYXRpb24gaXMgb25lIG9mIHRoZSBtb3N0IHBvd2VyZnVsIHRlY2huaXF1ZXMgaW4gbG9zcyBkYXRhIGFuYWx5dGljcyBzbyB3ZSBiZWxpZXZlIHRoaXMgZXhlcmNpc2UgaGVscGVkIHlvdSBhIGJpdCB0byBncm93IGFzIGFuIGV4cGVydCBpbiBsb3NzIGRhdGEgYW5hbHl0aWNzLlwiKSIsImhpbnQiOiJOb3RlIHRoYXQgd2UgbmVlZCB0byBzaW11bGF0ZSBjbGFpbSBhbW91bnRzIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIG51bWJlciBvZiBjbGFpbXMgc28gdGhhdCB0aGUgcGFyYW1ldGVycyB1c2VkIGluIDxjb2RlPnJ1bmlmKCk8L2NvZGU+IGZ1bmN0aW9uIG1heSBkZXBlbmQgb24gdGhlIG51bWJlciBvZiBzaW11bGF0ZWQgY2xhaW1zLiJ9
</div>
</div>
</div>
<div id="collective-risk-model---part-i" class="section level2">
<h2><span class="header-section-number">5.3</span> Collective Risk Model - Part I</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Build a collective risk model for a portfolio of insurance contracts</li>
<li>Calculate mean and variance of the aggregate loss</li>
<li>Fit frequency and severity components in a collective risk model</li>
</ul>
<hr />
<div id="video-collective-risk-model---part-i" class="section level4 unnumbered">
<h4>Video: Collective Risk Model - Part I</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_w76qa2ja&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_g39djg7z" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-collective-risk-model---part-i-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Collective Risk Model - Part I (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect531A')">A. Collective Risk Model</button>
<button class="tablinks" onclick="openTab(event, 'Sect531B')">B. Compound Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect531C')">C. Moments</button>
<button class="tablinks" onclick="openTab(event, 'Sect531D')">D. Model Fitting</button>
<button class="tablinks" onclick="openTab(event, 'Sect531E')">E. Model Fitting - Property Fund</button>
</div>
<div id="Sect531A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=20" width="100%" height="400"> </iframe>
</div>
<div id="Sect531B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=21" width="100%" height="400"> </iframe>
</div>
<div id="Sect531C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=22" width="100%" height="400"> </iframe>
</div>
<div id="Sect531D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=23" width="100%" height="400"> </iframe>
</div>
<div id="Sect531E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=24" width="100%" height="400"> </iframe>
</div>
</div>
<div id="exercise.-collective-risk-model-i" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Exercise. Collective Risk Model I</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we will fit a collective risk model for an actual portfolio of insurance
contracts, <strong>LGPIF</strong> data with <code>R</code>. We use <em>negative binomial</em> and <em>Pareto</em> distributions for the frequency and severity components, respectively.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>Use the function <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">optim()</a> to find the maximum likelihood estimates of the frequency and severity distributions.</li>
<li>For the likelihood of frequency component, we use <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/NegBinomial">dnbinom()</a>. Note that we use the same parametrization as in the <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-Frequency-Modeling.html#S:basic-frequency-distributions">textbook</a> so that <span class="math inline">\(\text{size}=r\)</span> and <span class="math inline">\(\text{prob}=1/(1+\beta)\)</span>.</li>
<li>For the likelihood of severity component, we use <a href="https://www.rdocumentation.org/packages/bayesmeta/versions/2.6/topics/dlomax">dlomax()</a>. Note that we use the same parametrization as in the <a href="https://openacttexts.github.io/Loss-Data-Analytics/C-Severity.html#S:ContinuousDistn">textbook</a> so that <span class="math inline">\(\text{shape}=\alpha\)</span> and <span class="math inline">\(\text{scale}=\theta\)</span>.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0RGV2L0xEQUNvdXJzZTEvbWFpbi9EYXRhL0luc2FtcGxlLmNzdlwiLCBoZWFkZXI9VCwgbmEuc3RyaW5ncz1jKFwiLlwiKSwgc3RyaW5nc0FzRmFjdG9ycz1GQUxTRSlcbmxpYnJhcnkobG1lNClcblxuZGxvbWF4IDwtIGZ1bmN0aW9uKHgsIHNoYXBlPTEsIHNjYWxlPTEsIGxvZz1GQUxTRSkge1xuICBpZiAobG9nPT1GQUxTRSkgcmVzdWx0IDwtIHNoYXBlKnNjYWxlXnNoYXBlIC8gKHNjYWxlICsgeCleKHNoYXBlKzEpXG4gIGlmIChsb2c9PVRSVUUgKSByZXN1bHQgPC0gbG9nKHNoYXBlKStzaGFwZSpsb2coc2NhbGUpLShzaGFwZSsxKSpsb2coc2NhbGUgKyB4KVxuICByZXR1cm4ocmVzdWx0KSB9Iiwic2FtcGxlIjoiSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5cbiMgVGhlIG5lZ2F0aXZlIGJpbm9taWFsIGZyZXF1ZW5jeSBtb2RlbDogTlxuTiA8LSBJbnNhbXBsZVRvd24kRnJlcVxuZnJlcV9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICByICAgIDwtIHBhcm1bMV1cbiAgYmV0YSA8LSBwYXJtWzJdXG4gIGxpayAgPC0gLXN1bShkbmJpbm9tKE4sIHNpemU9XywgcHJvYj0xLygxK19fXyksIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5mcmVxIDwtIGMobWVhbihOKS8odmFyKE4pL21lYW4oTiktMSksIHZhcihOKS9tZWFuKE4pLTEpICMgaW5pdGlhbCBlc3RpbWF0ZXMgYnkgbWV0aG9kIG9mIG1vbWVudHNcbmZyZXFfbW9kICAgICAgIDwtIF9fX19fKHBhcj1pbml0LnBhcm0uZnJlcSwgZm49X19fKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5cbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG5cbmZyZXFfdGFibGUgPC0gY2JpbmQodGFibGUoTilbMTo0XS9sZW5ndGgoTiksIGRuYmlub20oMDozLCBzaXplPV9fXywgcHJvYj0xLygxK2JldGEuZXN0KSkpXG5mcmVxX3RhYmxlIDwtIHJiaW5kKGZyZXFfdGFibGUsIDEtY29sU3VtcyhmcmVxX3RhYmxlKSlcbnJvd25hbWVzKGZyZXFfdGFibGUpWzVdIDwtIFwiNCtcIlxuY29sbmFtZXMoZnJlcV90YWJsZSkgICAgPC0gYyhcIkVtcGlyaWNhbFwiLCBcIlRoZW9yZXRpY2FsXCIpXG4jIEVtcGlyaWNhbCBhbmQgZml0dGVkIGRpc3RyaWJ1dGlvbnMgb2Ygb2JzZXJ2ZWQgTlxuZnJlcV90YWJsZVxuXG4jIFRoZSBQYXJldG8gc2V2ZXJpdHkgbW9kZWw6IFhiYXJcblhiYXIgPC0gSW5zYW1wbGVUb3duJHlBdmdbd2hpY2goSW5zYW1wbGVUb3duJEZyZXE+MCldXG5zZXZfbGlrIDwtIGZ1bmN0aW9uKHBhcm0pIHtcbiAgYWxwaGEgPC0gIHBhcm1bMV1cbiAgdGhldGEgPC0gIHBhcm1bMl1cbiAgbGlrICAgPC0gLXN1bShkbG9tYXgoWGJhciwgc2hhcGU9X19fLCBzY2FsZT1fX18sIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5zZXYgPC0gYyggMi8oMS1tZWFuKFhiYXIpXjIvdmFyKFhiYXIpKSAgLCBtZWFuKFhiYXIpKigyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpLTEpICkgIyBpbml0aWFsIGVzdGltYXRlcyBieSBtZXRob2Qgb2YgbW9tZW50c1xuc2V2X21vZCAgICAgICA8LSBfX19fXyhwYXI9X19fLCBmbj1zZXZfbGlrLCBtZXRob2Q9XCJMLUJGR1MtQlwiKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgc2V2ZXJpdHkgbW9kZWxcbmFscGhhLmVzdCAgICAgPC0gc2V2X21vZCRwYXJbMV1cbnRoZXRhLmVzdCAgICAgPC0gc2V2X21vZCRwYXJbMl1cblxuIyBFbXBpcmljYWwgYW5kIGZpdHRlZCBkaXN0cmlidXRpb25zIG9mIG9ic2VydmVkIFhiYXJcbnBsb3QoMS0odGhldGEuZXN0Lyh0aGV0YS5lc3Qrc29ydChYYmFyKSkpXmFscGhhLmVzdCwgcmFuayhzb3J0KFhiYXIpKS8obGVuZ3RoKFhiYXIpKzEpLFxuICAgICB5bGFiID0gXCJFbXBpcmljYWwgUXVhbnRpbGVzXCIsIHhsYWIgPSBcIlRoZW9yZXRpY2FsIFF1YW50aWxlc1wiLFxuICAgICBtYWluID0gXCJTZXZlcml0eSBNb2RlbFwiKSIsInNvbHV0aW9uIjoiSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5cbiMgVGhlIG5lZ2F0aXZlIGJpbm9taWFsIGZyZXF1ZW5jeSBtb2RlbDogTlxuTiA8LSBJbnNhbXBsZVRvd24kRnJlcVxuZnJlcV9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICByICAgIDwtIHBhcm1bMV1cbiAgYmV0YSA8LSBwYXJtWzJdXG4gIGxpayAgPC0gLXN1bShkbmJpbm9tKE4sIHNpemU9ciwgcHJvYj0xLygxK2JldGEpLCBsb2c9VFJVRSkpXG4gIHJldHVybihsaWspXG59XG5pbml0LnBhcm0uZnJlcSA8LSBjKG1lYW4oTikvKHZhcihOKS9tZWFuKE4pLTEpLCB2YXIoTikvbWVhbihOKS0xKSAjIGluaXRpYWwgZXN0aW1hdGVzIGJ5IG1ldGhvZCBvZiBtb21lbnRzXG5mcmVxX21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmZyZXEsIGZuPWZyZXFfbGlrKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5cbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG5cbmZyZXFfdGFibGUgPC0gY2JpbmQodGFibGUoTilbMTo0XS9sZW5ndGgoTiksIGRuYmlub20oMDozLCBzaXplPXIuZXN0LCBwcm9iPTEvKDErYmV0YS5lc3QpKSlcbmZyZXFfdGFibGUgPC0gcmJpbmQoZnJlcV90YWJsZSwgMS1jb2xTdW1zKGZyZXFfdGFibGUpKVxucm93bmFtZXMoZnJlcV90YWJsZSlbNV0gPC0gXCI0K1wiXG5jb2xuYW1lcyhmcmVxX3RhYmxlKSAgICA8LSBjKFwiRW1waXJpY2FsXCIsIFwiVGhlb3JldGljYWxcIilcbiMgRW1waXJpY2FsIGFuZCBmaXR0ZWQgZGlzdHJpYnV0aW9ucyBvZiBvYnNlcnZlZCBOXG5mcmVxX3RhYmxlXG5cbiMgVGhlIFBhcmV0byBzZXZlcml0eSBtb2RlbDogWGJhclxuWGJhciA8LSBJbnNhbXBsZVRvd24keUF2Z1t3aGljaChJbnNhbXBsZVRvd24kRnJlcT4wKV1cbnNldl9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICBhbHBoYSA8LSAgcGFybVsxXVxuICB0aGV0YSA8LSAgcGFybVsyXVxuICBsaWsgICA8LSAtc3VtKGRsb21heChYYmFyLCBzaGFwZT1hbHBoYSwgc2NhbGU9dGhldGEsIGxvZz1UUlVFKSlcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5zZXYgPC0gYyggMi8oMS1tZWFuKFhiYXIpXjIvdmFyKFhiYXIpKSAgLCBtZWFuKFhiYXIpKigyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpLTEpICkgIyBpbml0aWFsIGVzdGltYXRlcyBieSBtZXRob2Qgb2YgbW9tZW50c1xuc2V2X21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLnNldiwgZm49c2V2X2xpaywgbWV0aG9kPVwiTC1CRkdTLUJcIikgIyBNYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGlvbiBmb3IgdGhlIHNldmVyaXR5IG1vZGVsXG5hbHBoYS5lc3QgICAgIDwtIHNldl9tb2QkcGFyWzFdXG50aGV0YS5lc3QgICAgIDwtIHNldl9tb2QkcGFyWzJdXG5cbiMgRW1waXJpY2FsIGFuZCBmaXR0ZWQgZGlzdHJpYnV0aW9ucyBvZiBvYnNlcnZlZCBYYmFyXG5wbG90KDEtKHRoZXRhLmVzdC8odGhldGEuZXN0K3NvcnQoWGJhcikpKV5hbHBoYS5lc3QsIHJhbmsoc29ydChYYmFyKSkvKGxlbmd0aChYYmFyKSsxKSxcbiAgICAgeWxhYiA9IFwiRW1waXJpY2FsIFF1YW50aWxlc1wiLCB4bGFiID0gXCJUaGVvcmV0aWNhbCBRdWFudGlsZXNcIixcbiAgICAgbWFpbiA9IFwiU2V2ZXJpdHkgTW9kZWxcIikiLCJzY3QiOiJzdWNjZXNzX21zZyhcIkNoZWVycyEgTm90ZSB0aGF0IHdlIHVzdWFsbHkgYWRkIGNvdmFyaWF0ZXMgaW4gdGhlIGZyZXF1ZW5jeSBhbmQgc2V2ZXJpdHkgbW9kZWxzIGZvciByaXNrIGNsYXNzaWZpY2F0aW9uIHB1cnBvc2UgaW4gcHJhY3RpY2UuXCIpIiwiaGludCI6IlNpbmNlIDxlbT5vcHRpbTwvZW0+IG1pbmltaXplcyBnaXZlbiBmdW5jdGlvbiBieSBkZWZhdWx0LCB3ZSBwdXQgdGhlIG5lZ2F0aXZlIGxpa2VsaWhvb2QgYXMgYW4gb2JqZWN0aXZlIGZ1bmN0aW9uIHRvIGJlIG1pbmltaXplZC4ifQ==
</div>
</div>
</div>
<div id="collective-risk-model---part-ii" class="section level2">
<h2><span class="header-section-number">5.4</span> Collective Risk Model - Part II</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Compute the aggregate loss distribution</li>
<li>Implement numerical strategies in <code>R</code></li>
</ul>
<hr />
<div id="video-collective-risk-model---part-ii" class="section level4 unnumbered">
<h4>Video: Collective Risk Model - Part II</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_37zojz7d&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_v2a227tt" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-collective-risk-model---part-ii-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Collective Risk Model - Part II (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect532A')">A. Computing the Aggregate Loss Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect532B')">B. Direct Calculation</button>
<button class="tablinks" onclick="openTab(event, 'Sect532C')">C. Direct Calculation - R Code</button>
<button class="tablinks" onclick="openTab(event, 'Sect532D')">D. Recursive Method</button>
<button class="tablinks" onclick="openTab(event, 'Sect532E')">E. Recursive Method - R Code</button>
<button class="tablinks" onclick="openTab(event, 'Sect532F')">F. Monte Carlo Simulation</button>
</div>
<div id="Sect532A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=29" width="100%" height="400"> </iframe>
</div>
<div id="Sect532B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=30" width="100%" height="400"> </iframe>
</div>
<div id="Sect532C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=32" width="100%" height="400"> </iframe>
</div>
<div id="Sect532D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=34" width="100%" height="400"> </iframe>
</div>
<div id="Sect532E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=36" width="100%" height="400"> </iframe>
</div>
<div id="Sect532F" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=37" width="100%" height="400"> </iframe>
</div>
</div>
<div id="exercise.-collective-risk-model-ii" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Exercise. Collective Risk Model II</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we will analyze aggregate loss distribution by combining fitted frequency and severity components. Since it is usually very hard to obtain a closed form of distribution function of the compound loss in a collective risk model, we rely on simulations to compute the aggregate loss distribution.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>We use the fitted frequency and severity models using <strong>LGPIF</strong> data as we have done in Tutorial 5.3, with negative binomial and Pareto distributions, respectively.</li>
<li>To generate random samples from the fitted frequency and severity models, we use <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/NegBinomial">rnbinom()</a> and <a href="https://www.rdocumentation.org/packages/bayesmeta/versions/2.6/topics/dlomax">rlomax()</a>. Note that these generated random samples are used as inputs to compute the aggregate claim amount distribution.</li>
<li>We use <a href="https://www.rdocumentation.org/packages/actuar/versions/3.1-1/topics/aggregateDist">aggregateDist()</a> to simulate compound losses that match the observed data upon the fitted frequency and severity models. It is an important task in order to visualize the distribution of compound losses and make subsequent decisions on ratemaking.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0RGV2L0xEQUNvdXJzZTEvbWFpbi9EYXRhL0luc2FtcGxlLmNzdlwiLCBoZWFkZXI9VCwgbmEuc3RyaW5ncz1jKFwiLlwiKSwgc3RyaW5nc0FzRmFjdG9ycz1GQUxTRSlcbmxpYnJhcnkobG1lNClcblxuYWdncmVnYXRlLnBvcnRmb2xpbyA8LSBmdW5jdGlvbih4LCBieSA9IG5hbWVzKHgkbm9kZXMpLCBGVU4gPSBzdW0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzaWZpY2F0aW9uID0gVFJVRSwgcHJlZml4ID0gTlVMTCwgLi4uKVxue1xuICAgIGxldmVsLm5hbWVzIDwtIG5hbWVzKHgkbm9kZXMpICAgICAgICMgbGV2ZWwgbmFtZXNcbiAgICBubGV2ZWxzIDwtIGxlbmd0aChsZXZlbC5uYW1lcykgICAgICAjIG51bWJlciBvZiBsZXZlbHNcbiAgICB5ZWFycyA8LSBsZXZlbC5uYW1lc1tubGV2ZWxzXSAgICAgICAjIG5hbWUgb2YgbGFzdCBsZXZlbFxuXG4gICAgIyMgTWF0Y2ggbGV2ZWwgbmFtZXMgaW4gJ2J5JyB0byB0aG9zZSBpbiB0aGUgbW9kZWxcbiAgICBieSA8LSBtYXRjaC5hcmcoYnksIGxldmVsLm5hbWVzLCBzZXZlcmFsLm9rID0gVFJVRSlcblxuICAgICMjIFZlcnNpb24gb2YgRlVOIGFibGUgdG8gd29yayBvbiBsaXN0c1xuICAgIGZ1biA8LSBmdW5jdGlvbih4LCAuLi4pIEZVTih1bmxpc3QoeCksIC4uLilcblxuICAgICMjIFRoZSBtb3N0IGNvbW1vbiBjYXNlIHNob3VsZCBiZSB0byBhZ2dyZWdhdGUgY2xhaW0gYW1vdW50cyBieVxuICAgICMjIG5vZGUuIFRoaXMgY2FzZSBiZWluZyB2ZXJ5IHNpbXBsZSwgaXQgaXMgdHJlYXRlZCBzZXBhcmF0ZWx5LlxuICAgIGlmIChpZGVudGljYWwoYnksIGxldmVsLm5hbWVzKSlcbiAgICAgICAgcmV0dXJuKGNiaW5kKGlmIChjbGFzc2lmaWNhdGlvbikgeCRjbGFzc2lmaWNhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgIGFycmF5KHNhcHBseSh4JGRhdGEsIEZVTiwgLi4uKSwgZGltKHgkZGF0YSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBkaW1uYW1lcyA9IGxpc3QoTlVMTCwgcGFzdGUocHJlZml4LCBjb2xuYW1lcyh4JGRhdGEpLCBzZXAgPSBcIlwiKSkpKSlcblxuICAgICMjIFN1bW1hcmllcyBvbmx5IGJ5IGxhc3QgbGV2ZWwgKHllYXJzKSBhcmUgYWxzbyBzaW1wbGUgdG8gaGFuZGxlLlxuICAgIGlmIChpZGVudGljYWwoYnksIHllYXJzKSlcbiAgICB7XG4gICAgICAgIHJlcyA8LSBhcHBseSh4JGRhdGEsIDIsIGZ1biwgLi4uKVxuICAgICAgICBuYW1lcyhyZXMpIDwtIHBhc3RlKHByZWZpeCwgY29sbmFtZXMoeCRkYXRhKSwgc2VwID0gXCJcIilcbiAgICAgICAgcmV0dXJuKHJlcylcbiAgICB9XG5cbiAgICAjIyBUaGUgb3RoZXIgcG9zc2liaWxpdGllcyByZXF1aXJlIHRvIHNwbGl0IHRoZSBkYXRhIGluIGdyb3VwcyBhc1xuICAgICMjIHNwZWNpZmllZCBpbiBhcmd1bWVudCAnYnknLiBJZiB0aGUgbGFzdCBsZXZlbCAoeWVhcnMpIGlzIGluXG4gICAgIyMgJ2J5JywgdGhlbiB0aGUgbWF0cml4IHN0cnVjdHVyZSBtdXN0IGJlIHJldGFpbmVkIHRvIG1ha2UgdGhlXG4gICAgIyMgc3VtbWFyaWVzLiBPdGhlcndpc2UsIGl0IGNhbiBqdXN0IGJlIGRyb3BwZWQgc2luY2Ugc3VtbWFyaWVzXG4gICAgIyMgd2lsbCBzcGFuIHRoZSB5ZWFycyBvZiBvYnNlcnZhdGlvbi5cbiAgICAjI1xuICAgICMjIENvbnZlcnQgdGhlIHNlcXVlbmNlIG9mIHN1YnNjcmlwdHMgaW50byBmYWN0b3JzIGJ5IHBhc3RpbmcgdGhlXG4gICAgIyMgZGlnaXRzIHRvZ2V0aGVyLiBJdCBpcyBpbXBvcnRhbnQgKm5vdCogdG8gc29ydCB0aGUgbGV2ZWxzIGluXG4gICAgIyMgY2FzZSB0aGUgbGV2ZWxzIGluICdieScgYXJlIG5vdCBpbiB0aGUgc2FtZSBvcmRlciBhcyBpblxuICAgICMjICdsZXZlbC5uYW1lcycuXG4gICAgcm93cyA8LSBzZXRkaWZmKGJ5LCB5ZWFycykgICAgICAgICAgIyBncm91cHMgb3RoZXIgdGhhbiB5ZWFyc1xuICAgIHMgPC0geCRjbGFzc2lmaWNhdGlvblssIHJvd3MsIGRyb3AgPSBGQUxTRV0gIyBzdWJzY3JpcHRzXG4gICAgZiA8LSBhcHBseShzLCAxLCBwYXN0ZSwgY29sbGFwc2UgPSBcIlwiKSAgICAgICMgZ3JvdXBpbmcgSURzXG4gICAgZiA8LSBmYWN0b3IoZiwgbGV2ZWxzID0gdW5pcXVlKGYpKSAgICAgICAgICAjIGZhY3RvcnNcbiAgICBzIDwtIHNbbWF0Y2gobGV2ZWxzKGYpLCBmKSwgLCBkcm9wID0gRkFMU0VdICMgdW5pcXVlIHN1YnNjcmlwdHNcbiAgICB4eCA8LSBzcGxpdCh4JGRhdGEsIGYpICAgICAgICAgICAgICAgICAgICAgICMgc3BsaXQgZGF0YVxuXG4gICAgIyMgTWFrZSBzdW1tYXJpZXNcbiAgICBpZiAoeWVhcnMgJWluJSBieSlcbiAgICB7XG4gICAgICAgIHh4IDwtIGxhcHBseSh4eCwgbWF0cml4LCBuY29sID0gbmNvbCh4JGRhdGEpKVxuICAgICAgICByZXMgPC0gdChzYXBwbHkoeHgsIGZ1bmN0aW9uKHgsIC4uLikgYXBwbHkoeCwgMiwgZnVuLCAuLi4pLCAuLi4pKVxuICAgICAgICBjb2xzIDwtIGNvbG5hbWVzKHgkZGF0YSlcbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgICAgcmVzIDwtIHNhcHBseSh4eCwgZnVuLCAuLi4pXG4gICAgICAgIGNvbHMgPC0gZGVwYXJzZShzdWJzdGl0dXRlKEZVTikpXG4gICAgfVxuXG4gICAgIyMgUmV0dXJuIHJlc3VsdHMgYXMgYSBtYXRyaXhcbiAgICBzdHJ1Y3R1cmUoY2JpbmQoaWYgKGNsYXNzaWZpY2F0aW9uKSBzLCByZXMpLFxuICAgICAgICAgICAgICBkaW1uYW1lcyA9IGxpc3QoTlVMTCwgYyhpZiAoY2xhc3NpZmljYXRpb24pIHJvd3MsIHBhc3RlKHByZWZpeCwgY29scywgc2VwID0gXCJcIikpKSlcbn1cblxuc2ltUyA8LSBmdW5jdGlvbihuLCBtb2RlbC5mcmVxLCBtb2RlbC5zZXYpXG57XG4gIFxuICAgIG49MTAwMFxuICAgIG1vZGVsLmZyZXEgPSBmcmVxXG4gICAgbW9kZWwuc2V2ID0gc2V2XG4gICAgXG4gICAgIyMgUHJlcGFyZSB0aGUgY2FsbCB0byBzaW11bCgpIGJ5IGJ1aWxkaW5nIHVwICdub2RlcydcbiAgICBsZXZlbC5uYW1lcyA8LSBuYW1lcyhpZiAoaXMubnVsbChtb2RlbC5mcmVxKSkgbW9kZWwuc2V2IGVsc2UgbW9kZWwuZnJlcSlcbiAgICBubGV2ZWxzIDwtIGxlbmd0aChsZXZlbC5uYW1lcylcbiAgICBub2RlcyA8LSBhcy5saXN0KGMocmVwKDEsIG5sZXZlbHMgLSAxKSwgbikpXG4gICAgbmFtZXMobm9kZXMpIDwtIGxldmVsLm5hbWVzXG5cbiAgICAjIyBHZXQgc2FtcGxlXG4gICAgeCA8LSBhZ2dyZWdhdGUoc2ltdWwobm9kZXMgPSBub2RlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5mcmVxID0gbW9kZWwuZnJlcSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5zZXYgPSBtb2RlbC5zZXYpKVstMV1cblxuICAgICMjIENvbXB1dGUgdGhlIGVtcGlyaWNhbCBjZGYgb2YgdGhlIHNhbXBsZS4gRG9uZSBtYW51YWxseSBpbnN0ZWFkXG4gICAgIyMgb2YgY2FsbGluZyBzdGF0czo6OmVjZGYoKSB0byBrZWVwIGEgY29weSBvZiB0aGUgZW1waXJpY2FsIHBtZlxuICAgICMjIGluIHRoZSBlbnZpcm9ubWVudCB3aXRob3V0IGNvbXB1dGluZyBpdCB0d2ljZS5cbiAgICB4IDwtIHNvcnQoeClcbiAgICB2YWxzIDwtIHVuaXF1ZSh4KVxuICAgIGZzIDwtIHRhYnVsYXRlKG1hdGNoKHgsIHZhbHMpKS9sZW5ndGgoeClcbiAgICBGVU4gPC0gYXBwcm94ZnVuKHZhbHMsIHBtaW4oY3Vtc3VtKGZzKSwgMSksIG1ldGhvZCA9IFwiY29uc3RhbnRcIixcbiAgICAgICAgICAgICAgICAgICAgIHlsZWZ0ID0gMCwgeXJpZ2h0ID0gMSwgZiA9IDAsIHRpZXMgPSBcIm9yZGVyZWRcIilcbiAgICBjbGFzcyhGVU4pIDwtIGMoXCJlY2RmXCIsIFwic3RlcGZ1blwiLCBjbGFzcyhGVU4pKVxuICAgIGFzc2lnbihcImZzXCIsIGZzLCBlbnZpciA9IGVudmlyb25tZW50KEZVTikpXG4gICAgRlVOXG59XG5cbmFnZ3JlZ2F0ZURpc3QgPC1cbiAgICBmdW5jdGlvbihtZXRob2QgPSBjKFwicmVjdXJzaXZlXCIsIFwiY29udm9sdXRpb25cIiwgXCJub3JtYWxcIiwgXCJucG93ZXJcIiwgXCJzaW11bGF0aW9uXCIpLFxuICAgICAgICAgICAgIG1vZGVsLmZyZXEgPSBOVUxMLCBtb2RlbC5zZXYgPSBOVUxMLCBwMCA9IE5VTEwsIHguc2NhbGUgPSAxLFxuICAgICAgICAgICAgIGNvbnZvbHZlID0gMCwgbW9tZW50cywgbmIuc2ltdWwsIC4uLixcbiAgICAgICAgICAgICB0b2wgPSAxZS0wNiwgbWF4aXQgPSA1MDAsIGVjaG8gPSBGQUxTRSlcbntcbiAgICBDYWxsIDwtIG1hdGNoLmNhbGwoKVxuXG4gICAgIyMgVGhlIG1ldGhvZCB1c2VkIGVzc2VudGlhbGx5IHRlbGxzIHdoaWNoIGZ1bmN0aW9uIHNob3VsZCBiZVxuICAgICMjIGNhbGxlZCBmb3IgdGhlIGNhbGN1bGF0aW9uIG9mIHRoZSBhZ2dyZWdhdGUgY2xhaW1zXG4gICAgIyMgZGlzdHJpYnV0aW9uLlxuICAgIG1ldGhvZCA8LSBtYXRjaC5hcmcobWV0aG9kKVxuXG4gICAgaWYgKG1ldGhvZCA9PSBcIm5vcm1hbFwiKVxuICAgIHtcbiAgICAgICAgIyMgQW4gZXJyb3IgbWVzc2FnZSBpcyBpc3N1ZWQgaWYgdGhlIG51bWJlciBvZiBtb21lbnRzIGxpc3RlZFxuICAgICAgICAjIyBpcyBub3QgYXBwcm9wcmlhdGUgZm9yIHRoZSBtZXRob2QuIEhvd2V2ZXIgaXQgaXMgdGhlIHVzZXInc1xuICAgICAgICAjIyByZXNwb25zYWJpbGl0eSB0byBsaXN0IHRoZSBtb21lbnRzIGluIHRoZSBjb3JyZWN0IG9yZGVyXG4gICAgICAgICMjIHNpbmNlIHRoZSB2ZWN0b3IgaXMgbm90IHJlcXVpcmVkIHRvIGJlIG5hbWVkLlxuICAgICAgICBpZiAobWlzc2luZyhtb21lbnRzKSB8fCBsZW5ndGgobW9tZW50cykgPCAyKVxuICAgICAgICAgICAgc3RvcChcIidtb21lbnRzJyBtdXN0IHN1cHBseSB0aGUgbWVhbiBhbmQgdmFyaWFuY2Ugb2YgdGhlIGRpc3RyaWJ1dGlvblwiKVxuICAgICAgICBGVU4gPC0gbm9ybWFsKG1vbWVudHNbMV0sIG1vbWVudHNbMl0pXG4gICAgICAgIGNvbW1lbnQoRlVOKSA8LSBcIk5vcm1hbCBhcHByb3hpbWF0aW9uXCJcbiAgICB9XG5cbiAgICBlbHNlIGlmIChtZXRob2QgPT0gXCJucG93ZXJcIilcbiAgICB7XG4gICAgICAgIGlmIChtaXNzaW5nKG1vbWVudHMpIHx8IGxlbmd0aChtb21lbnRzKSA8IDMpXG4gICAgICAgICAgICBzdG9wKFwiJ21vbWVudHMnIG11c3Qgc3VwcGx5IHRoZSBtZWFuLCB2YXJpYW5jZSBhbmQgc2tld25lc3Mgb2YgdGhlIGRpc3RyaWJ1dGlvblwiKVxuICAgICAgICBGVU4gPC0gbnBvd2VyKG1vbWVudHNbMV0sIG1vbWVudHNbMl0sIG1vbWVudHNbM10pXG4gICAgICAgIGNvbW1lbnQoRlVOKSA8LSBcIk5vcm1hbCBQb3dlciBhcHByb3hpbWF0aW9uXCJcbiAgICB9XG4gICAgZWxzZSBpZiAobWV0aG9kID09IFwic2ltdWxhdGlvblwiKVxuICAgIHtcbiAgICAgICAgaWYgKG1pc3NpbmcobmIuc2ltdWwpKVxuICAgICAgICAgICAgc3RvcChcIiduYi5zaW11bCcgbXVzdCBzdXBwbHkgdGhlIG51bWJlciBvZiBzaW11bGF0aW9uc1wiKVxuICAgICAgICBpZiAoaXMubnVsbChuYW1lcyhtb2RlbC5mcmVxKSkgJiYgaXMubnVsbChuYW1lcyhtb2RlbC5zZXYpKSlcbiAgICAgICAgICAgIHN0b3AoXCJleHByZXNzaW9ucyBpbiAnbW9kZWwuZnJlcScgYW5kICdtb2RlbC5zZXYnIG11c3QgYmUgbmFtZWRcIilcbiAgICAgICAgRlVOIDwtIHNpbVMobmIuc2ltdWwsIG1vZGVsLmZyZXEgPSBtb2RlbC5mcmVxLCBtb2RlbC5zZXYgPSBtb2RlbC5zZXYpXG4gICAgICAgIGNvbW1lbnQoRlVOKSA8LSBcIkFwcHJveGltYXRpb24gYnkgc2ltdWxhdGlvblwiXG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgICMjIFwicmVjdXJzaXZlXCIgYW5kIFwiY29udm9sdXRpb25cIiBjYXNlcy4gQm90aCByZXF1aXJlIGFcbiAgICAgICAgIyMgZGlzY3JldGUgZGlzdHJpYnV0aW9uIG9mIGNsYWltIGFtb3VudHMsIHRoYXQgaXMgYSB2ZWN0b3Igb2ZcbiAgICAgICAgIyMgcHJvYmFiaWxpdGllcyBpbiBhcmd1bWVudCAnbW9kZWwuc2V2Jy5cbiAgICAgICAgaWYgKCFpcy5udW1lcmljKG1vZGVsLnNldikpXG4gICAgICAgICAgICBzdG9wKFwiJ21vZGVsLnNldicgbXVzdCBiZSBhIHZlY3RvciBvZiBwcm9iYWJpbGl0aWVzXCIpXG5cbiAgICAgICAgIyMgUmVjdXJzaXZlIG1ldGhvZCB1c2VzIGEgbW9kZWwgZm9yIHRoZSBmcmVxdWVuY3kgZGlzdHJpYnV0aW9uLlxuICAgICAgICBpZiAobWV0aG9kID09IFwicmVjdXJzaXZlXCIpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmIChpcy5udWxsKG1vZGVsLmZyZXEpIHx8ICFpcy5jaGFyYWN0ZXIobW9kZWwuZnJlcSkpXG4gICAgICAgICAgICAgICAgc3RvcChcImZyZXF1ZW5jeSBkaXN0cmlidXRpb24gbXVzdCBiZSBzdXBwbGllZCBhcyBhIGNoYXJhY3RlciBzdHJpbmdcIilcbiAgICAgICAgICAgIGRpc3QgPC0gbWF0Y2guYXJnKHRvbG93ZXIobW9kZWwuZnJlcSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjKFwicG9pc3NvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImdlb21ldHJpY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5lZ2F0aXZlIGJpbm9taWFsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiYmlub21pYWxcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsb2dhcml0aG1pY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tdHJ1bmNhdGVkIHBvaXNzb25cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLXRydW5jYXRlZCBnZW9tZXRyaWNcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ6ZXJvLXRydW5jYXRlZCBuZWdhdGl2ZSBiaW5vbWlhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tdHJ1bmNhdGVkIGJpbm9taWFsXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiemVyby1tb2RpZmllZCBsb2dhcml0aG1pY1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tbW9kaWZpZWQgcG9pc3NvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tbW9kaWZpZWQgZ2VvbWV0cmljXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiemVyby1tb2RpZmllZCBuZWdhdGl2ZSBiaW5vbWlhbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInplcm8tbW9kaWZpZWQgYmlub21pYWxcIikpXG4gICAgICAgICAgICBGVU4gPC0gcGFuamVyKGZ4ID0gbW9kZWwuc2V2LCBkaXN0ID0gZGlzdCwgcDAgPSBwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgeC5zY2FsZSA9IHguc2NhbGUsIC4uLiwgY29udm9sdmUgPSBjb252b2x2ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdG9sID0gdG9sLCBtYXhpdCA9IG1heGl0LCBlY2hvID0gZWNobylcbiAgICAgICAgICAgIGNvbW1lbnQoRlVOKSA8LSBcIlJlY3Vyc2l2ZSBtZXRob2QgYXBwcm94aW1hdGlvblwiXG4gICAgICAgIH1cblxuICAgICAgICAjIyBDb252b2x1dGlvbiBtZXRob2QgcmVxdWlyZXMgYSB2ZWN0b3Igb2YgcHJvYmFiaWxpdGVzIGluXG4gICAgICAgICMjIGFyZ3VtZW50ICdtb2RlbC5mcmVxJy5cbiAgICAgICAgZWxzZSBpZiAobWV0aG9kID09IFwiY29udm9sdXRpb25cIilcbiAgICAgICAge1xuICAgICAgICAgICAgaWYgKCFpcy5udW1lcmljKG1vZGVsLmZyZXEpKVxuICAgICAgICAgICAgICAgIHN0b3AoXCInbW9kZWwuZnJlcScgbXVzdCBiZSBhIHZlY3RvciBvZiBwcm9iYWJpbGl0aWVzXCIpXG4gICAgICAgICAgICBGVU4gPC0gZXhhY3QoZnggPSBtb2RlbC5zZXYsIHBuID0gbW9kZWwuZnJlcSwgeC5zY2FsZSA9IHguc2NhbGUpXG4gICAgICAgICAgICBjb21tZW50KEZVTikgPC0gXCJFeGFjdCBjYWxjdWxhdGlvbiAoY29udm9sdXRpb25zKVwiXG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgc3RvcChcImludGVybmFsIGVycm9yXCIpXG4gICAgfVxuXG4gICAgIyMgUmV0dXJuIGN1bXVsYXRpdmUgZGlzdHJpYnV0aW9uIGZ1bmN0aW9uXG4gICAgY2xhc3MoRlVOKSA8LSBjKFwiYWdncmVnYXRlRGlzdFwiLCBjbGFzcyhGVU4pKVxuICAgIGF0dHIoRlVOLCBcImNhbGxcIikgPC0gQ2FsbFxuICAgIEZVTlxuICAgIH1cblxuXG5wbG90LmFnZ3JlZ2F0ZURpc3QgPC0gZnVuY3Rpb24oeCwgeGxpbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5bGFiID0gZXhwcmVzc2lvbihGW1NdKHgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWluID0gXCJBZ2dyZWdhdGUgQ2xhaW0gQW1vdW50IERpc3RyaWJ1dGlvblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YiA9IGNvbW1lbnQoeCksIC4uLilcbntcbiAgICAjIyBGdW5jdGlvbiBwbG90KCkgaXMgdXNlZCBmb3IgdGhlIHN0ZXAgY2RmcyBhbmQgZnVuY3Rpb24gY3VydmUoKVxuICAgICMjIGluIHRoZSBjb250aW51b3VzIGNhc2VzLlxuICAgIGlmIChcInN0ZXBmdW5cIiAlaW4lIGNsYXNzKHgpKVxuICAgIHtcbiAgICAgICAgIyMgTWV0aG9kIGZvciBjbGFzcyAnZWNkZicgd2lsbCBtb3N0IHByb2JhYmx5IGJlIHVzZWQuXG4gICAgICAgIE5leHRNZXRob2QobWFpbiA9IG1haW4sIHlsYWIgPSB5bGFiLCAuLi4pXG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICAgICMjIExpbWl0cyBmb3IgdGhlIHgtYXhpcyBhcmUgc3VwcGxpZWQgaWYgbm9uZSBhcmUgZ2l2ZW5cbiAgICAgICAgIyMgaW4gYXJndW1lbnQuXG4gICAgICAgIGlmIChtaXNzaW5nKHhsaW0pKVxuICAgICAgICB7XG4gICAgICAgICAgICBtZWFuIDwtIGdldChcIm1lYW5cIiwgZW52aXIgPSBlbnZpcm9ubWVudCh4KSlcbiAgICAgICAgICAgIHNkIDwtIHNxcnQoZ2V0KFwidmFyaWFuY2VcIiwgZW52aXIgPSBlbnZpcm9ubWVudCh4KSkpXG4gICAgICAgICAgICB4bGltIDwtIGMobWVhbiAtIDMgKiBzZCwgbWVhbiArIDMgKiBzZClcbiAgICAgICAgfVxuICAgICAgICBjdXJ2ZSh4LCBtYWluID0gbWFpbiwgeWxhYiA9IHlsYWIsIHhsaW0gPSB4bGltLCB5bGltID0gYygwLCAxKSwgLi4uKVxuICAgIH1cbiAgICBtdGV4dChzdWIsIGxpbmUgPSAwLjUpXG59XG5cbnNpbXVsIDwtIGZ1bmN0aW9uKG5vZGVzLCBtb2RlbC5mcmVxID0gTlVMTCwgbW9kZWwuc2V2ID0gTlVMTCwgd2VpZ2h0cyA9IE5VTEwpXG57XG4gICAgIyMgR2V0IGxldmVsIG5hbWVzLiBFYWNoIGNvdWxkIGJlIE5VTEwuXG4gICAgbGV2ZWwubmFtZXMgPC0gbmFtZXMobm9kZXMpXG4gICAgZnJlcS5uYW1lcyA8LSBuYW1lcyhtb2RlbC5mcmVxKVxuICAgIHNldi5uYW1lcyA8LSBuYW1lcyhtb2RlbC5zZXYpXG5cbiAgICAjIyAnbm9kZXMnIG11c3QgYmUgYSBuYW1lZCBsaXN0LiBPbmUgZXhjZXB0aW9uIGlzIGFsbG93ZWQ6IHRoZXJlXG4gICAgIyMgaXMgb25seSBvbmUgbGV2ZWwuIEluIHRoaXMgY2FzZSwgYWRkIGEgcHJlZGV0ZXJtaW5lZCBuYW1lIGlmXG4gICAgIyMgdGhlcmUgaXNuJ3Qgb25lIGFscmVhZHkgYW5kIG1ha2Ugc3VyZSAnbm9kZXMnIGlzIGEgbGlzdC5cbiAgICBpZiAobGVuZ3RoKG5vZGVzKSA9PSAxTClcbiAgICB7XG4gICAgICAgIGlmIChpcy5udWxsKGxldmVsLm5hbWVzKSlcbiAgICAgICAgICAgIG5hbWVzKG5vZGVzKSA8LSBcIlhcIlxuICAgICAgICBub2RlcyA8LSBhcy5saXN0KG5vZGVzKVxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgICBpZiAoIWlzLmxpc3Qobm9kZXMpIHx8IGlzLm51bGwobGV2ZWwubmFtZXMpKVxuICAgICAgICAgICAgc3RvcChcIidub2RlcycgbXVzdCBiZSBhIG5hbWVkIGxpc3RcIilcbiAgICB9XG5cbiAgICAjIyBEZXRlcm1pbmUgaWYgZnJlcXVlbmN5IGFuZCBzZXZlcml0eSBtb2RlbHMgYXJlIHByZXNlbnQuIEtlZXBcbiAgICAjIyBmb3IgZnV0dXJlIHVzZS5cbiAgICBoYXMuZnJlcSA8LSAhYWxsKHNhcHBseShtb2RlbC5mcmVxLCBpcy5udWxsKSlcbiAgICBoYXMuc2V2ICA8LSAhYWxsKHNhcHBseShtb2RlbC5zZXYsIGlzLm51bGwpKVxuXG4gICAgIyMgQ2hlY2sgdGhhdCBhdCBsZWFzdCBvbmUgb2YgJ21vZGVsLmZyZXEnIG9yICdtb2RlbC5zZXYnIGlzXG4gICAgIyMgcHJlc2VudCBhbmQgdGhhdCB0aGUgbGV2ZWwgbmFtZXMgbWF0Y2ggd2l0aCB0aG9zZSBvZiAnbm9kZXMnLlxuICAgICMjIFBlcmhhcHMgaXMgdGhlcmUgYSBmYW5jaWVyIHdheSB0byBkbyBhbGwgdGhlc2UgdGVzdHMsIGJ1dCB0aGVcbiAgICAjIyB2ZXJzaW9uIGJlbG93IGlzIGF0IGxlYXN0IGVhc3kgdG8gZm9sbG93LlxuICAgIGlmIChoYXMuZnJlcSlcbiAgICB7XG4gICAgICAgIGlmIChoYXMuc2V2KVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoISAoaWRlbnRpY2FsKGxldmVsLm5hbWVzLCBmcmVxLm5hbWVzKSAmJlxuICAgICAgICAgICAgICAgICAgIGlkZW50aWNhbChsZXZlbC5uYW1lcywgc2V2Lm5hbWVzKSkpXG4gICAgICAgICAgICAgICAgc3RvcChcImxldmVsIG5hbWVzIGRpZmZlcmVudCBpbiAnbm9kZXMnLCAnbW9kZWwuZnJlcScgYW5kICdtb2RlbC5zZXYnXCIpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICBpZiAoIWlkZW50aWNhbChsZXZlbC5uYW1lcywgZnJlcS5uYW1lcykpXG4gICAgICAgICAgICAgICAgc3RvcChcImxldmVsIG5hbWVzIGRpZmZlcmVudCBpbiAnbm9kZXMnLCAnbW9kZWwuZnJlcScgYW5kICdtb2RlbC5zZXYnXCIpXG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgICAgaWYgKGhhcy5zZXYpXG4gICAgICAgIHtcbiAgICAgICAgICAgIGlmICghaWRlbnRpY2FsKGxldmVsLm5hbWVzLCBzZXYubmFtZXMpKVxuICAgICAgICAgICAgICAgIHN0b3AoXCJsZXZlbCBuYW1lcyBkaWZmZXJlbnQgaW4gJ25vZGVzJywgJ21vZGVsLmZyZXEnIGFuZCAnbW9kZWwuc2V2J1wiKVxuICAgICAgICB9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHN0b3AoXCJvbmUgb2YgJ21vZGVsLmZyZXEnIG9yICdtb2RlbC5zZXYnIG11c3QgYmUgbm9uLU5VTExcIilcbiAgICB9XG5cbiAgICAjIyBUaGUgZnVuY3Rpb24gaXMgd3JpdHRlbiBmb3IgbW9kZWxzIHdpdGggYXQgbGVhc3QgdHdvIGxldmVsc1xuICAgICMjIChlbnRpdHkgYW5kIHllYXIpLiBJZiB0aGVyZSBpcyBvbmx5IG9uZSwgYWRkIGEgZHVtbXkgbGV2ZWwgdG9cbiAgICAjIyBhdm9pZCBzY2F0dGVyaW5nIHRoZSBjb2RlIHdpdGggY29uZGl0aW9ucy5cbiAgICBpZiAobGVuZ3RoKG5vZGVzKSA8IDJMKVxuICAgIHtcbiAgICAgICAgbm9kZXMgPC0gYyhub2RlID0gMSwgbm9kZXMpXG4gICAgICAgIG1vZGVsLmZyZXEgPC1cbiAgICAgICAgICAgIGlmIChoYXMuZnJlcSkgYyhleHByZXNzaW9uKG5vZGUgPSBOVUxMKSwgbW9kZWwuZnJlcSkgZWxzZSBOVUxMXG4gICAgICAgIG1vZGVsLnNldiA8LVxuICAgICAgICAgICAgaWYgKGhhcy5zZXYpIGMoZXhwcmVzc2lvbihub2RlID0gTlVMTCksIG1vZGVsLnNldikgZWxzZSBOVUxMXG4gICAgfVxuXG4gICAgIyMgRnJlcXVlbnRseSB1c2VkIHF1YW50aXRpZXNcbiAgICBsZXZlbC5uYW1lcyA8LSBuYW1lcyhub2RlcykgICAgICAgICAjIG5lZWQgdG8gcmVzZXQhXG4gICAgbmxldmVscyA8LSBsZW5ndGgobm9kZXMpICAgICAgICAgICAgIyBudW1iZXIgb2YgbGV2ZWxzXG5cbiAgICAjIyBSZWN5Y2xpbmcgb2YgdGhlIG51bWJlciBvZiBub2RlcyAoaWYgbmVlZGVkKSBtdXN0IGJlIGRvbmVcbiAgICAjIyBcIm1hbnVhbGx5XCIuIFdlIGRvIGl0IGhlcmUgb25jZSBhbmQgZm9yIGFsbCBzaW5jZSBpbiBhbnkgY2FzZVxuICAgICMjIGJlbG93IHdlIHdpbGwgbmVlZCB0byBrbm93IHRoZSB0b3RhbCBudW1iZXIgb2Ygbm9kZXMgaW4gdGhlXG4gICAgIyMgcG9ydGZvbGlvLiBGdXJ0aGVybW9yZSwgdGhlIHJlY3ljbGVkIGxpc3QgJ25vZGVzJyB3aWxsIGJlXG4gICAgIyMgcmV0dXJuZWQgYnkgdGhlIGZ1bmN0aW9uLlxuICAgIGZvciAoaSBpbiAyTDpubGV2ZWxzKSAgICAgICAjIGZpcnN0IG5vZGUgZG9lc24ndCBuZWVkIHJlY3ljbGluZ1xuICAgICAgICBub2Rlc1tbaV1dIDwtIHJlcChub2Rlc1tbaV1dLCBsZW5ndGggPSBzdW0obm9kZXNbW2kgLSAxTF1dKSlcblxuICAgICMjIFNpbXVsYXRpb24gb2YgdGhlIGZyZXF1ZW5jeSBtaXhpbmcgcGFyYW1ldGVycyBmb3IgZWFjaCBsZXZlbFxuICAgICMjIChlLmcuIGNsYXNzLCBjb250cmFjdCkgYW5kLCBhdCB0aGUgbGFzdCBsZXZlbCwgdGhlIGFjdHVhbFxuICAgICMjIGZyZXF1ZW5jaWVzLiBJZiAnbW9kZWwuZnJlcScgaXMgTlVMTCwgdGhpcyBpcyBlcXVpdmFsZW50IHRvXG4gICAgIyMgaGF2aW5nIG9uZSBjbGFpbSBwZXIgbm9kZS5cbiAgICBpZiAoaGFzLmZyZXEpXG4gICAge1xuICAgICAgICAjIyBOb3JtYWxseSwgb25seSB0aGUgaW1tZWRpYXRlbHkgYWJvdmUgbWl4aW5nIHBhcmFtZXRlciB3aWxsXG4gICAgICAgICMjIGJlIHVzZWQgaW4gdGhlIG1vZGVsIGZvciBhIGxldmVsLCBidXQgdGhlIGNvZGUgaGVyZSBhbGxvd3NcbiAgICAgICAgIyMgZm9yIG1vcmUgZ2VuZXJhbCBzY2hlbWVzLiBGb3IgdGhpcyB0byB3b3JrLCBhbGwgbWl4aW5nXG4gICAgICAgICMjIHBhcmFtZXRlcnMgaGF2ZSB0byBiZSBjb3JyZWN0bHkgcmVjeWNsZWQgYXQgZWFjaCBsZXZlbFxuICAgICAgICAjIyB3aGVyZSB0aGV5ICpjb3VsZCogYmUgdXNlZC4gU2luY2UgdGhlIG1vZGVsIGF0IGFueSBsZXZlbFxuICAgICAgICAjIyBjb3VsZCBiZSBOVUxMLCAncGFyYW1zJyB3aWxsIGtlZXAgdHJhY2sgb2YgdGhlIG1peGluZ1xuICAgICAgICAjIyBwYXJhbWV0ZXJzIHRoYXQgd2VyZSBzaW11bGF0ZWQgaW4gcHJldmlvdXMgaXRlcmF0aW9uIG9mIHRoZVxuICAgICAgICAjIyBmb3J0aGNvbWluZyBsb29wLlxuICAgICAgICBwYXJhbXMgPC0gY2hhcmFjdGVyKDApXG5cbiAgICAgICAgZm9yIChpIGluIHNlcV9sZW4obmxldmVscykpXG4gICAgICAgIHtcbiAgICAgICAgICAgICMjIE51bWJlciBvZiBub2RlcyBhdCB0aGUgY3VycmVudCBsZXZlbFxuICAgICAgICAgICAgbi5jdXJyZW50IDwtIG5vZGVzW1tpXV1cblxuICAgICAgICAgICAgIyMgRXh0cmFjdCBzaW11bGF0aW9uIG1vZGVsIGZvciB0aGUgbGV2ZWwuXG4gICAgICAgICAgICBDYWxsIDwtIG1vZGVsLmZyZXFbW2ldXVxuXG4gICAgICAgICAgICAjIyBSZXBlYXQgdGhlIG1peGluZyBwYXJhbWV0ZXJzIG9mIGFsbCBsZXZlbHMgYWJvdmUgdGhlXG4gICAgICAgICAgICAjIyBjdXJyZW50IG9uZSB0aGF0IHdlcmUgc2ltdWxhdGVkIGluIHRoZSBwYXN0LlxuICAgICAgICAgICAgZm9yIChqIGluIHNlcV9hbG9uZyhwYXJhbXMpKVxuICAgICAgICAgICAgICAgIGV2YWwoc3Vic3RpdHV0ZSh4IDwtIHJlcC5pbnQoeCwgbi5jdXJyZW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCh4ID0gYXMubmFtZShwYXJhbXNbW2pdXSkpKSlcblxuICAgICAgICAgICAgIyMgU2ltdWxhdGUgZGF0YSBvbmx5IGlmIHRoZXJlIGlzIGEgbW9kZWwgYXQgdGhlIGN1cnJlbnRcbiAgICAgICAgICAgICMjIGxldmVsLlxuICAgICAgICAgICAgaWYgKCFpcy5udWxsKENhbGwpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICMjIEFkZCB0aGUgbnVtYmVyIG9mIHZhcmlhdGVzIHRvIHRoZSBjYWxsLlxuICAgICAgICAgICAgICAgIENhbGwkbiA8LSBzdW0obi5jdXJyZW50KVxuXG4gICAgICAgICAgICAgICAgIyMgU2ltdWxhdGlvbiBvZiB0aGUgbWl4aW5nIHBhcmFtZXRlcnMgb3IgdGhlIGRhdGEuIEluXG4gICAgICAgICAgICAgICAgIyMgdGhlIGxhdHRlciBjYXNlLCBzdG9yZSB0aGUgcmVzdWx0cyBpbiBhIGZpeGVkXG4gICAgICAgICAgICAgICAgIyMgdmFyaWFibGUgbmFtZS5cbiAgICAgICAgICAgICAgICBpZiAoaSA8IG5sZXZlbHMpXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhc3NpZ24obGV2ZWwubmFtZXNbW2ldXSwgZXZhbChDYWxsKSlcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW2ldIDwtIGxldmVsLm5hbWVzW1tpXV0gIyByZW1lbWJlciB0aGUgcGFyYW1ldGVyXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZnJlcXVlbmNpZXMgPC0gZXZhbChDYWxsKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2VcbiAgICAgICAgZnJlcXVlbmNpZXMgPC0gcmVwLmludCgxLCBzdW0obm9kZXNbW25sZXZlbHNdXSkpXG5cbiAgICAjIyBTaW11bGF0aW9uIG9mIHRoZSBjbGFpbSBhbW91bnRzLiBJZiAnbW9kZWwuc2V2JyBpcyBOVUxMLCB0aGlzXG4gICAgIyMgaXMgZXF1aXZhbGVudCB0byBzaW11bGF0aW5nIGZyZXF1ZW5jaWVzIG9ubHkuXG4gICAgaWYgKGhhcy5zZXYpXG4gICAge1xuICAgICAgICAjIyBSZXBlYXQgdGhlIHNhbWUgcHJvY2VkdXJlIGFzIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsLCB3aXRoXG4gICAgICAgICMjIG9uZSBkaWZmZXJlbmNlOiB3aGVuIHJlYWNoaW5nIHRoZSBsYXN0IGxldmVsIChjbGFpbVxuICAgICAgICAjIyBhbW91bnRzKSwgdGhlIG51bWJlciBvZiB2YXJpYXRlcyB0byBzaW11bGF0ZSBpcyBub3QgZ2l2ZW5cbiAgICAgICAgIyMgYnkgdGhlIG51bWJlciBvZiBub2RlcyBidXQgcmF0aGVyIGJ5IHRoZSBudW1iZXIgb2YgY2xhaW1zXG4gICAgICAgICMjIGFzIGZvdW5kIGluICdmcmVxdWVuY2llcycuXG4gICAgICAgIHBhcmFtcyA8LSBjaGFyYWN0ZXIoMClcblxuICAgICAgICBmb3IgKGkgaW4gc2VxX2xlbihubGV2ZWxzKSlcbiAgICAgICAge1xuICAgICAgICAgICAgbi5jdXJyZW50IDwtIG5vZGVzW1tpXV1cbiAgICAgICAgICAgIENhbGwgPC0gbW9kZWwuc2V2W1tpXV1cblxuICAgICAgICAgICAgZm9yIChqIGluIHNlcV9hbG9uZyhwYXJhbXMpKVxuICAgICAgICAgICAgICAgIGV2YWwoc3Vic3RpdHV0ZSh4IDwtIHJlcC5pbnQoeCwgbi5jdXJyZW50KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCh4ID0gYXMubmFtZShwYXJhbXNbW2pdXSkpKSlcblxuICAgICAgICAgICAgaWYgKCFpcy5udWxsKENhbGwpKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICMjIFRoZSByZXN0IG9mIHRoZSBwcm9jZWR1cmUgZGlmZmVycyBkZXBlbmRpbmcgaWYgd2VcbiAgICAgICAgICAgICAgICAjIyBhcmUgc3RpbGwgc2ltdWxhdGluZyBtaXhpbmcgcGFyYW1ldGVycyBvciBjbGFpbVxuICAgICAgICAgICAgICAgICMjIGFtb3VudHMuXG4gICAgICAgICAgICAgICAgaWYgKGkgPCBubGV2ZWxzKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgIyMgU2ltdWxhdGlvbiBvZiBtaXhpbmcgcGFyYW1ldGVycyBpcyBpZGVudGljYWwgdG8gdGhlXG4gICAgICAgICAgICAgICAgICAgICMjIHNpbXVsYXRpb24gb2YgZnJlcXVlbmNpZXMuXG4gICAgICAgICAgICAgICAgICAgIENhbGwkbiA8LSBzdW0obi5jdXJyZW50KVxuICAgICAgICAgICAgICAgICAgICBhc3NpZ24obGV2ZWwubmFtZXNbW2ldXSwgZXZhbChDYWxsKSlcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zW2ldIDwtIGxldmVsLm5hbWVzW1tpXV1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgIyMgRm9yIHRoZSBzaW11bGF0aW9uIG9mIGNsYWltIGFtb3VudHMsIHRoZSBudW1iZXJcbiAgICAgICAgICAgICAgICAgICAgIyMgb2YgdmFyaWF0ZXMgaXMgcmF0aGVyIGdpdmVuIGJ5IHRoZVxuICAgICAgICAgICAgICAgICAgICAjIyAnZnJlcXVlbmNpZXMnIG9iamVjdC4gRnVydGhlcm1vcmUsIHRoZSBtaXhpbmdcbiAgICAgICAgICAgICAgICAgICAgIyMgcGFyYW1ldGVycyBtdXN0IGJlIHJlY3ljbGVkIG9uY2UgbW9yZSB0byBtYXRjaFxuICAgICAgICAgICAgICAgICAgICAjIyB0aGUgdmVjdG9yIG9mIGZyZXF1ZW5jaWVzLlxuICAgICAgICAgICAgICAgICAgICBmb3IgKHAgaW4gaW50ZXJzZWN0KGFsbC52YXJzKENhbGwpLCBwYXJhbXMpKVxuICAgICAgICAgICAgICAgICAgICAgICAgZXZhbChzdWJzdGl0dXRlKHggPC0gcmVwLmludCh4LCBmcmVxdWVuY2llcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdCh4ID0gYXMubmFtZShwKSkpKVxuICAgICAgICAgICAgICAgICAgICBDYWxsJG4gPC0gc3VtKGZyZXF1ZW5jaWVzKVxuICAgICAgICAgICAgICAgICAgICBzZXZlcml0aWVzIDwtZXZhbChDYWxsKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIHNldmVyaXRpZXMgPC0gcmVwLmludCgxLCBzdW0oZnJlcXVlbmNpZXMpKVxuXG4gICAgIyMgV2UgbXVzdCBub3cgZGlzdHJpYnV0ZSB0aGUgY2xhaW0gYW1vdW50cyBpbiB2ZWN0b3IgJ3NldmVyaXRpZXMnXG4gICAgIyMgdG8gdGhlIGFwcHJvcHJpYXRlIG5vZGVzLiBUaGlzIGlzIGNvbXBsaWNhdGVkIGJ5IHRoZVxuICAgICMjIHBvc3NpYmlsaXR5IHRvIGhhdmUgZGlmZmVyZW50IG51bWJlciBvZiBub2RlcyAoeWVhcnMgb2ZcbiAgICAjIyBvYnNlcnZhdGlvbikgZm9yIGVhY2ggZW50aXR5LiBUaGUgcmVzdWx0IG11c3QgYmUgYSBtYXRyaXhcbiAgICAjIyB3aXRoIHRoZSBudW1iZXIgb2YgY29sdW1ucyBlcXVhbCB0byB0aGUgbWF4aW11bSBudW1iZXIgb2YgbGFzdFxuICAgICMjIGxldmVsIG5vZGVzLlxuICAgICMjXG4gICAgIyMgVGhlIG51bWJlciBvZiBub2RlcyAoeWVhcnMgb2Ygb2JzZXJ2YXRpb24pIHBlciBlbnRpdHkgaXNcbiAgICAjIyBnaXZlbiBieSAnbi5jdXJyZW50JyBzaW5jZSB3ZSByZWFjaGVkIHRoZSBsYXN0IGxldmVsIGluIChlaXRoZXJcbiAgICAjIyBvbmUgb2YpIHRoZSBhYm92ZSBsb29wcy5cbiAgICAjI1xuICAgICMjIEFzc2lnbiBhIHVuaXF1ZSBJRCB0byBlYWNoIG5vZGUsIGxlYXZpbmcgZ2FwcyBmb3Igbm9kZXMgd2l0aG91dFxuICAgICMjIG9ic2VydmF0aW9ucy5cbiAgICBpbmQgPC0gdW5saXN0KG1hcHBseShzZXEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHNlcShieSA9IG1heChuLmN1cnJlbnQpLCBhbG9uZyA9IG4uY3VycmVudCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gbi5jdXJyZW50KSlcblxuICAgICMjIFJlcGVhdGluZyB0aGUgdmVjdG9yIG9mIElEcyBhY2NvcmRpbmcgdG8gdGhlIGZyZXF1ZW5jaWVzXG4gICAgIyMgZWZmZWN0aXZlbHkgYXNzaWducyBhIG5vZGUgSUQgdG8gZWFjaCBjbGFpbSBhbW91bnQuIFRoZSB2ZWN0b3JcbiAgICAjIyBvZiBjbGFpbSBhbW91bnRzIGlzIHRoZW4gc3BsaXQgYnkgbm9kZSwgeWllbGRpbmcgYSBsaXN0IHdoZXJlXG4gICAgIyMgZWFjaCBlbGVtZW50IGNvcnJlc3BvbmRzIHRvIGEgbm9kZSB3aXRoIGNsYWltcy5cbiAgICBmIDwtIHJlcC5pbnQoaW5kLCBmcmVxdWVuY2llcylcbiAgICBzZXZlcml0aWVzIDwtIHNwbGl0KHNldmVyaXRpZXMsIGYpXG5cbiAgICAjIyBJZGVudGlmeSBub2RlcyB3aXRoIGZyZXF1ZW5jeSBlcXVhbCB0byAwLCB3aGljaCBpcyBkaWZmZXJlbnRcbiAgICAjIyBmcm9tIGhhdmluZyBubyBvYnNlcnZhdGlvbiAoTkEpLlxuICAgIGZyZXEwIDwtIGluZFt3aGljaChmcmVxdWVuY2llcyA9PSAwKV1cblxuICAgICMjIFJlYXJyYW5nZSB0aGUgbGlzdCBvZiBjbGFpbSBhbW91bnRzIGluIGEgbWF0cml4O1xuICAgICMjXG4gICAgIyMgICAgICBudW1iZXIgb2Ygcm93czogbnVtYmVyIG9mIG5vZGVzIGF0IHRoZSBwZW51bHRpbWF0ZSBsZXZlbFxuICAgICMjICAgICAgICAgICAgICAgICAgICAgIChudW1iZXIgb2YgZW50aXRpZXMpXG4gICAgIyMgICBudW1iZXIgb2YgY29sdW1uczogbWF4aW11bSBudW1iZXIgb2Ygbm9kZXMgYXQgdGhlIGxhc3QgbGV2ZWxcbiAgICAjIyAgICAgICAgICAgICAgICAgICAgICAobnVtYmVyIG9mIHllYXJzIG9mIG9ic2VydmF0aW9uKS5cbiAgICAjI1xuICAgICMjIE1vcmVvdmVyLCBhc3NpZ24gYSB2YWx1ZSBvZiAnbnVtZXJpYygwKScgdG8gbm9kZXMgd2l0aCBhXG4gICAgIyMgZnJlcXVlbmN5IG9mIDAuXG4gICAgbnJvdyA8LSBsZW5ndGgobi5jdXJyZW50KSAgICAgICAgICAgIyBudW1iZXIgb2YgZW50aXRpZXNcbiAgICBuY29sIDwtIG1heChuLmN1cnJlbnQpICAgICAgICAgICAgICAjIG51bWJlciBvZiB5ZWFyc1xuICAgIHJlcyA8LSBhcy5saXN0KHJlcC5pbnQoTkEsIG5yb3cgKiBuY29sKSlcbiAgICByZXNbdW5pcXVlKGYpXSA8LSBzZXZlcml0aWVzXG4gICAgcmVzW2ZyZXEwXSA8LSBsYXBwbHkocmVwLmludCgwLCBsZW5ndGgoZnJlcTApKSwgbnVtZXJpYylcbiAgICByZXMgPC0gbWF0cml4KHJlcywgbnJvdywgbmNvbCwgYnlyb3cgPSBUUlVFLFxuICAgICAgICAgICAgICAgICAgZGltbmFtZXMgPSBsaXN0KE5VTEwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzdGUobGV2ZWwubmFtZXNbbmxldmVsc10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VxX2xlbihuY29sKSwgc2VwID0gXCIuXCIpKSlcblxuICAgICMjIFJlc2hhcGUgd2VpZ2h0cyBhcyBhIG1hdHJpeCwgaWYgbmVjZXNzYXJ5LlxuICAgIHdlaWdodHMgPC0gaWYgKGlzLm51bGwod2VpZ2h0cykpXG4gICAgICAgIE5VTExcbiAgICBlbHNlXG4gICAge1xuICAgICAgICAjIyBJbnRlZ3JhdGUgTkFzIGludG8gdGhlIHdlaWdodHMgbWF0cml4IGFzIGFwcHJvcHJpYXRlLlxuICAgICAgICB3IDwtIHJlcC5pbnQoTkEsIG5yb3cgKiBuY29sKVxuICAgICAgICB3W2luZF0gPC0gd2VpZ2h0c1xuICAgICAgICBtYXRyaXgodywgbnJvdyA9IG5yb3csIGJ5cm93ID0gVFJVRSwgZGltbmFtZXMgPSBkaW1uYW1lcyhyZXMpKVxuICAgIH1cblxuICAgICMjIEZpbmFsbHksIGNyZWF0ZSBhIG1hdHJpeCB3aGVyZSBlYWNoIHJvdyBjb250YWlucyB0aGUgc2VyaWVzIG9mXG4gICAgIyMgaWRlbnRpZmllcnMgZm9yIGFuIGVudGl0eSBpbiB0aGUgcG9ydGZvbGlvLCBlLmcuIGlmIHRoZSBkYXRhXG4gICAgIyMgaXMgZGVub3RlZCBYX3tpamt0fSwgb25lIGxpbmUgb2YgdGhlIG1hdHJpeCB3aWxsIGNvbnRhaW5cbiAgICAjIyBzdWJzY3JpcHRzIGksIGogYW5kIGsuIEFzIHdlIG1vdmUgZnJvbSByaWdodCB0byBsZWZ0IGluIHRoZVxuICAgICMjIGNvbHVtbnMgb2YgJ20nLCB0aGUgc3ViY3JpcHRzIGFyZSBpbmNyZWFzaW5nbHkgcmVwZWF0ZWQuXG4gICAgbmNvbCA8LSBubGV2ZWxzIC0gMUxcbiAgICBtIDwtIG1hdHJpeCgxLCBucm93LCBuY29sLFxuICAgICAgICAgICAgICAgIGRpbW5hbWVzID0gbGlzdChOVUxMLCBoZWFkKGxldmVsLm5hbWVzLCBuY29sKSkpXG4gICAgZm9yIChpIGluIHNlcV9sZW4obmNvbCAtIDFMKSkgICAgIyBhbGwgYnV0IHRoZSBsYXN0IGNvbHVtblxuICAgIHtcbiAgICAgICAgIyMgVmVjdG9yICd4JyB3aWxsIG9yaWdpbmFsbHkgY29udGFpbiBhbGwgc3Vic2NyaXB0cyBmb3Igb25lXG4gICAgICAgICMjIGxldmVsLiBUaGVzZSBzdWJzY3JpcHRzIGFyZSB0aGVuIHJlcGVhdGVkIGFzIG5lZWRlZCB0byBnaXZlXG4gICAgICAgICMjIHRoZSBkZXNpcmVkIHJlc3VsdC4gVG8gYXZvaWQgYW5vdGhlciBleHBsaWNpdCBsb29wLCBJIHVzZSBhXG4gICAgICAgICMjICdsYXBwbHknIHdpdGggYSBkaXJlY3QgYXNzaWdubWVudCBpbiB0aGUgY3VycmVudFxuICAgICAgICAjIyBmcmFtZS4gU29tZXdoYXQgdW51c3VhbCwgYnV0IHRoaXMgaXMgdGhlIHNpbXBsZXN0IHByb2NlZHVyZVxuICAgICAgICAjIyBJIG1hbmFnZWQgdG8gY29tZSB1cCB3aXRoLlxuICAgICAgICB4IDwtIHVubGlzdChsYXBwbHkobm9kZXNbW2ldXSwgc2VxKSlcbiAgICAgICAgbGFwcGx5KG5vZGVzWyhpICsgMUwpOihubGV2ZWxzIC0gMUwpXSxcbiAgICAgICAgICAgICAgIGZ1bmN0aW9uKHYpIGFzc2lnbihcInhcIiwgcmVwLmludCh4LCB2KSwgZW52aXIgPSBwYXJlbnQuZnJhbWUoMikpKVxuICAgICAgICBtWywgaV0gPC0geFxuICAgIH1cbiAgICBtWywgbmNvbF0gPC0gdW5saXN0KGxhcHBseShub2Rlc1tbbmNvbF1dLCBzZXEpKSAjIGxhc3QgY29sdW1uXG5cbiAgICAjIyBSZXR1cm4gb2JqZWN0IG9mIGNsYXNzICdwb3J0Zm9saW8nXG4gICAgc3RydWN0dXJlKGxpc3QoZGF0YSA9IHJlcyxcbiAgICAgICAgICAgICAgICAgICB3ZWlnaHRzID0gd2VpZ2h0cyxcbiAgICAgICAgICAgICAgICAgICBjbGFzc2lmaWNhdGlvbiA9IG0sXG4gICAgICAgICAgICAgICAgICAgbm9kZXMgPSBub2RlcyxcbiAgICAgICAgICAgICAgICAgICBtb2RlbC5mcmVxID0gbW9kZWwuZnJlcSxcbiAgICAgICAgICAgICAgICAgICBtb2RlbC5zZXYgPSBtb2RlbC5zZXYpLFxuICAgICAgICAgICAgICBjbGFzcyA9IFwicG9ydGZvbGlvXCIpXG59XG5cbmRsb21heCA8LSBmdW5jdGlvbih4LCBzaGFwZT0xLCBzY2FsZT0xLCBsb2c9RkFMU0UpIHtcbiAgaWYgKGxvZz09RkFMU0UpIHJlc3VsdCA8LSBzaGFwZSpzY2FsZV5zaGFwZSAvIChzY2FsZSArIHgpXihzaGFwZSsxKVxuICBpZiAobG9nPT1UUlVFICkgcmVzdWx0IDwtIGxvZyhzaGFwZSkrc2hhcGUqbG9nKHNjYWxlKS0oc2hhcGUrMSkqbG9nKHNjYWxlICsgeClcbiAgcmV0dXJuKHJlc3VsdCkgfVxuXG5ybG9tYXggPC0gZnVuY3Rpb24obiwgc2hhcGU9MSwgc2NhbGU9MSkge1xuICB1IDwtIHJ1bmlmKG4pXG4gIHJlc3VsdCA8LSBzY2FsZSooKDEgLSB1KV4oLTEvc2hhcGUpLTEpXG4gIHJldHVybihyZXN1bHQpIH1cblxuSW5zYW1wbGVUb3duIDwtIHN1YnNldChJbnNhbXBsZSwgVHlwZVRvd249PTEpXG5cbiMgVGhlIG5lZ2F0aXZlIGJpbm9taWFsIGZyZXF1ZW5jeSBtb2RlbDogTlxuTiA8LSBJbnNhbXBsZVRvd24kRnJlcVxuZnJlcV9saWsgPC0gZnVuY3Rpb24ocGFybSkge1xuICByICAgIDwtIHBhcm1bMV1cbiAgYmV0YSA8LSBwYXJtWzJdXG4gIGxpayAgPC0gLXN1bShkbmJpbm9tKE4sIHNpemU9ciwgcHJvYj0xLygxK2JldGEpLCBsb2c9VFJVRSkpXG4gIHJldHVybihsaWspXG59XG5pbml0LnBhcm0uZnJlcSA8LSBjKG1lYW4oTikvKHZhcihOKS9tZWFuKE4pLTEpLCB2YXIoTikvbWVhbihOKS0xKSAjIGluaXRpYWwgZXN0aW1hdGVzIGJ5IG1ldGhvZCBvZiBtb21lbnRzXG5mcmVxX21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmZyZXEsIGZuPWZyZXFfbGlrKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgZnJlcXVlbmN5IG1vZGVsXG5cbnIuZXN0ICAgIDwtIGZyZXFfbW9kJHBhclsxXVxuYmV0YS5lc3QgPC0gZnJlcV9tb2QkcGFyWzJdXG5cblxuIyBUaGUgUGFyZXRvIHNldmVyaXR5IG1vZGVsOiBYYmFyXG5YYmFyIDwtIEluc2FtcGxlVG93biR5QXZnW3doaWNoKEluc2FtcGxlVG93biRGcmVxPjApXVxuc2V2X2xpayA8LSBmdW5jdGlvbihwYXJtKSB7XG4gIGFscGhhIDwtICBwYXJtWzFdXG4gIHRoZXRhIDwtICBwYXJtWzJdXG4gIGxpayAgIDwtIC1zdW0oZGxvbWF4KFhiYXIsIHNoYXBlPWFscGhhLCBzY2FsZT10aGV0YSwgbG9nPVRSVUUpKVxuICByZXR1cm4obGlrKVxufVxuaW5pdC5wYXJtLnNldiA8LSBjKCAyLygxLW1lYW4oWGJhcileMi92YXIoWGJhcikpICAsIG1lYW4oWGJhcikqKDIvKDEtbWVhbihYYmFyKV4yL3ZhcihYYmFyKSktMSkgKSAjIGluaXRpYWwgZXN0aW1hdGVzIGJ5IG1ldGhvZCBvZiBtb21lbnRzXG5zZXZfbW9kICAgICAgIDwtIG9wdGltKHBhcj1pbml0LnBhcm0uc2V2LCBmbj1zZXZfbGlrLCBtZXRob2Q9XCJMLUJGR1MtQlwiKSAjIE1heGltdW0gbGlrZWxpaG9vZCBlc3RpbWF0aW9uIGZvciB0aGUgc2V2ZXJpdHkgbW9kZWxcbmFscGhhLmVzdCAgICAgPC0gc2V2X21vZCRwYXJbMV1cbnRoZXRhLmVzdCAgICAgPC0gc2V2X21vZCRwYXJbMl0iLCJzYW1wbGUiOiIjIFBhcmFtZXRlciBlc3RpbWF0ZXMgZnJvbSB0aGUgZnJlcXVlbmN5IG1vZGVsOiBhbHBoYS5lc3QsIHRoZXRhLmVzdFxuIyBQYXJhbWV0ZXIgZXN0aW1hdGVzIGZyb20gdGhlIHNldmVyaXR5ICBtb2RlbDogICAgIHIuZXN0LCAgYmV0YS5lc3RcblxuZnJlcSA8LSBleHByZXNzaW9uKGRhdGEgPSAgX19fX19fKHNpemU9X19fXywgcHJvYj0xLygxK19fX19fKSkpICAjIHJhbmRvbSBzYW1wbGVzIGZyb20gdGhlIGZpdHRlZCBmcmVxdWVuY3kgbW9kZWxcbnNldiAgPC0gZXhwcmVzc2lvbihkYXRhID0gIF9fX19fXyhzaGFwZT1fX19fX19fXywgc2NhbGU9X19fX19fXykpICMgcmFuZG9tIHNhbXBsZXMgZnJvbSB0aGUgZml0dGVkIHNldmVyaXR5IG1vZGVsXG5GcyAgIDwtIGFnZ3JlZ2F0ZURpc3QoXCJzaW11bGF0aW9uXCIsIG5iLnNpbXVsID0gMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5mcmVxID0gX19fXywgbW9kZWwuc2V2ID0gX19fXylcbnBsb3QoRnMpXG5saW5lcyhlY2RmKEluc2FtcGxlVG93biR5KSwgIGNvbD1cImJsdWVcIilcblxubGVnZW5kKFwiYm90dG9tcmlnaHRcIiwgbGVnZW5kID0gYyhcIlNpbXVsYXRpb25cIiwgXCJFbXBpcmljYWxcIiksIGNvbD1jKFwiYmxhY2tcIixcImJsdWVcIiksIGx0eT1jKDEsMiksIHBjaD1jKDEsIDE5KSkiLCJzb2x1dGlvbiI6IiMgUGFyYW1ldGVyIGVzdGltYXRlcyBmcm9tIHRoZSBmcmVxdWVuY3kgbW9kZWw6IGFscGhhLmVzdCwgdGhldGEuZXN0XG4jIFBhcmFtZXRlciBlc3RpbWF0ZXMgZnJvbSB0aGUgc2V2ZXJpdHkgIG1vZGVsOiAgICAgci5lc3QsICBiZXRhLmVzdFxuXG5mcmVxIDwtIGV4cHJlc3Npb24oZGF0YSA9ICBybmJpbm9tKHNpemU9ci5lc3QsIHByb2I9MS8oMStiZXRhLmVzdCkpKSAjIHJhbmRvbSBzYW1wbGVzIGZyb20gdGhlIGZpdHRlZCBmcmVxdWVuY3kgbW9kZWxcbnNldiAgPC0gZXhwcmVzc2lvbihkYXRhID0gIHJsb21heChzaGFwZT1hbHBoYS5lc3QsIHNjYWxlPXRoZXRhLmVzdCkpICMgcmFuZG9tIHNhbXBsZXMgZnJvbSB0aGUgZml0dGVkIHNldmVyaXR5IG1vZGVsXG5GcyAgIDwtIGFnZ3JlZ2F0ZURpc3QoXCJzaW11bGF0aW9uXCIsIG5iLnNpbXVsID0gMTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5mcmVxID0gZnJlcSwgbW9kZWwuc2V2ID0gc2V2KVxucGxvdChGcylcbmxpbmVzKGVjZGYoSW5zYW1wbGVUb3duJHkpLCAgY29sPVwiYmx1ZVwiKVxuXG5sZWdlbmQoXCJib3R0b21yaWdodFwiLCBsZWdlbmQgPSBjKFwiU2ltdWxhdGlvblwiLCBcIkVtcGlyaWNhbFwiKSwgY29sPWMoXCJibGFja1wiLFwiYmx1ZVwiKSwgbHR5PWMoMSwyKSwgcGNoPWMoMSwgMTkpKSIsInNjdCI6InN1Y2Nlc3NfbXNnKFwiR29vZCBqb2IhIFRoaXMgaXMgdGhlIHNlY29uZCB0aW1lIHRoYXQgd2UgdXNlZCB0aGUgc2ltdWxhdGlvbiB0ZWNobmlxdWUuIE5vdGUgdGhhdCBpdCBpcyB1c3VhbCB0byBvYnNlcnZlIHRoYXQgYW4gYWN0dWFsIGNsYWltcyBkYXRhc2V0IG1heSBjb21lIHdpdGggdmVyeSBmZXcgcG9zaXRpdmUgY2xhaW1zIGJ1dCBhbHNvIGhlYXZ5IHRhaWwgYmVoYXZpb3IuXCIpIiwiaGludCI6IldlIHNob3VsZCB1c2UgdGhlIGVzdGltYXRlZCBwYXJhbWV0ZXJzIGZyb20gdGhlIGZyZXF1ZW5jeSBhbmQgc2V2ZXJpdHkgZGlzdHJpYnV0aW9ucyBpbiBjYWxjdWxhdGlvbiBvZiB0aGUgYWdncmVnYXRlIGNsYWltIGFtb3VudCBkaXN0cmlidXRpb24uIn0=
</div>
</div>
</div>
<div id="tweedie-distribution" class="section level2">
<h2><span class="header-section-number">5.5</span> Tweedie Distribution</h2>
<p>In this section, we learn how to:</p>
<ul>
<li>Construct the Tweedie distribution from a collective risk model</li>
<li>Establish the Tweedie distribution as a member of the exponential family of distributions</li>
<li>Fit Tweedie distribution as a generalized linear model</li>
</ul>
<hr />
<div id="video-tweedie-distribution" class="section level4 unnumbered">
<h4>Video: Tweedie Distribution</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_lxnu6a93&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_jjd6r5f9" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-tweedie-distribution-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Tweedie Distribution (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect54A')">A. Tweedie Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect54B')">B. Tweedie Distribution with Exposure</button>
<button class="tablinks" onclick="openTab(event, 'Sect54C')">C. Distribution Function for Tweedie Distribution</button>
<button class="tablinks" onclick="openTab(event, 'Sect54D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect54E')">E. Example - R Code</button>
</div>
<div id="Sect54A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=41" width="100%" height="400"> </iframe>
</div>
<div id="Sect54B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=42" width="100%" height="400"> </iframe>
</div>
<div id="Sect54C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=43" width="100%" height="400"> </iframe>
</div>
<div id="Sect54D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=45" width="100%" height="400"> </iframe>
</div>
<div id="Sect54E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=46" width="100%" height="400"> </iframe>
</div>
</div>
<div id="exercise.-tweedie-distribution" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Exercise. Tweedie Distribution</h3>
<p><strong>Assignment Text</strong></p>
<p>In this assignment, we will fit a Tweedie model for a collective risk model using observed compound losses in LGPIF data with <code>R</code>. Unlike the previous tutorials that required seperate model fitting for the frequency and severity components, use of Tweedie distribution enables us to fit a collective risk model in one step.</p>
<div class="blackbox">
<p><strong>Instructions</strong></p>
<ul>
<li>For the likelihood of the compound loss, We use <a href="https://www.rdocumentation.org/packages/tweedie/versions/2.3.3/topics/Tweedie">dtweedie()</a>, which is one of the built-in functions of <code>R</code> library <a href="https://cran.r-project.org/web/packages/tweedie/tweedie.pdf">tweedie</a> .</li>
<li>From the fitted Tweedie model via <a href="https://www.rdocumentation.org/packages/stats/versions/3.6.2/topics/optim">optim()</a>, extract the estimated mu, phi, and p.</li>
<li>After estimating the parameters of the Tweedie model, plot the empiricial quantiles against the quantiles from the fitted model. Note that we generate the theoretical quantiles via <a href="https://www.rdocumentation.org/packages/tweedie/versions/2.3.3/topics/Tweedie">qtweedie()</a> and the estimated Tweedie parameters.</li>
</ul>
</div>
<p><br></p>
<div data-datacamp-exercise="" data-height="300" data-encoded="true">
eyJsYW5ndWFnZSI6InIiLCJwcmVfZXhlcmNpc2VfY29kZSI6Ikluc2FtcGxlIDwtIHJlYWQuY3N2KFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0RGV2L0xEQUNvdXJzZTEvbWFpbi9EYXRhL0luc2FtcGxlLmNzdlwiLCBoZWFkZXI9VCwgbmEuc3RyaW5ncz1jKFwiLlwiKSwgc3RyaW5nc0FzRmFjdG9ycz1GQUxTRSlcbmxpYnJhcnkobG1lNClcblxuc291cmNlKFwiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL09wZW5BY3RUZXh0RGV2L0xEQUNvdXJzZTEvbWFpbi9SQ29kZS9Ud2VlZGllU291cmNlQ29kZS5SbWRcIikiLCJzYW1wbGUiOiJJbnNhbXBsZVRvd24gPC0gc3Vic2V0KEluc2FtcGxlLCBUeXBlVG93bj09MSlcblxuIyBUaGUgVHdlZWRpZSBjb21wb3VuZCBsb3NzIG1vZGVsOiBTXG5TIDwtIF9fX19fJHlcbmNvbXBsb3NzX2xpayA8LSBmdW5jdGlvbihwYXJtKSB7XG4gIG11ICAgIDwtIHBhcm1bMV1cbiAgcGhpICAgPC0gcGFybVsyXVxuICBwICAgICA8LSBwYXJtWzNdXG4gIGxpayAgPC0gLXN1bSggIGxvZyhkdHdlZWRpZShTLCBtdT1tdSwgcGhpPXBoaSwgcG93ZXI9XykpIClcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5jb21wbG9zcyA8LSBjKCBtZWFuKFMpLCAzMDAsIDEuNSkgICAgIyBpbml0aWFsIGVzdGltYXRlcyBcbmNvbXBsb3NzX21vZCAgICAgICA8LSBvcHRpbShwYXI9X19fX19fLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZuPV9fX19fXywgbWV0aG9kPVwiTC1CRkdTLUJcIikgIyBNYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGlvbiBmb3IgdGhlIGNvbXBvdW5kIGxvc3MgbW9kZWxcblxuXG5tdS5lc3QgIDwtIGNvbXBsb3NzX21vZCRwYXJbMV1cbnBoaS5lc3QgPC0gY29tcGxvc3NfbW9kJF9fX1xucC5lc3QgICA8LSBjb21wbG9zc19tb2QkX19fXG5cbnBjdCA8LSBzZXEoMC4wMSwwLjk5LDAuMDEpXG5wbG90KHF0d2VlZGllKHBjdCwgbXU9X19fXywgcGhpPV9fX18sIHBvd2VyPXAuZXN0KSAscXVhbnRpbGUoSW5zYW1wbGVUb3duJHksIHByb2JzPXBjdCksIHhsYWI9XCJUaGVvcmV0aWNhbCBRdWFudGlsZVwiLCB5bGFiPVwiRW1waXJpY2FsIFF1YW50aWxlXCIsIHhsaW09YygwLDUwMDAwKSwgeWxpbT1jKDAsNTAwMDApKVxuYWJsaW5lKDAsMSkiLCJzb2x1dGlvbiI6Ikluc2FtcGxlVG93biA8LSBzdWJzZXQoSW5zYW1wbGUsIFR5cGVUb3duPT0xKVxuXG4jIFRoZSBUd2VlZGllIGNvbXBvdW5kIGxvc3MgbW9kZWw6IFNcblMgPC0gSW5zYW1wbGVUb3duJHlcbmNvbXBsb3NzX2xpayA8LSBmdW5jdGlvbihwYXJtKSB7XG4gIG11ICAgIDwtIHBhcm1bMV1cbiAgcGhpICAgPC0gcGFybVsyXVxuICBwICAgICA8LSBwYXJtWzNdXG4gIGxpayAgPC0gLXN1bSggIGxvZyhkdHdlZWRpZShTLCBtdT1tdSwgcGhpPXBoaSwgcG93ZXI9cCkpIClcbiAgcmV0dXJuKGxpaylcbn1cbmluaXQucGFybS5jb21wbG9zcyA8LSBjKCBtZWFuKFMpLCAzMDAsIDEuNSkgICAgIyBpbml0aWFsIGVzdGltYXRlcyBcbmNvbXBsb3NzX21vZCAgICAgICA8LSBvcHRpbShwYXI9aW5pdC5wYXJtLmNvbXBsb3NzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZuPWNvbXBsb3NzX2xpaywgbWV0aG9kPVwiQ0dcIikgIyBNYXhpbXVtIGxpa2VsaWhvb2QgZXN0aW1hdGlvbiBmb3IgdGhlIGNvbXBvdW5kIGxvc3MgbW9kZWxcblxuXG5tdS5lc3QgIDwtIGNvbXBsb3NzX21vZCRwYXJbMV1cbnBoaS5lc3QgPC0gY29tcGxvc3NfbW9kJHBhclsyXVxucC5lc3QgICA8LSBjb21wbG9zc19tb2QkcGFyWzNdXG5cbnBjdCA8LSBzZXEoMC4wMSwwLjk5LDAuMDEpXG5wbG90KHF0d2VlZGllKHBjdCwgbXU9bXUuZXN0LCBwaGk9cGhpLmVzdCwgcG93ZXI9cC5lc3QpICxxdWFudGlsZShJbnNhbXBsZVRvd24keSwgcHJvYnM9cGN0KSwgeGxhYj1cIlRoZW9yZXRpY2FsIFF1YW50aWxlXCIsIHlsYWI9XCJFbXBpcmljYWwgUXVhbnRpbGVcIiwgeGxpbT1jKDAsNTAwMDApLCB5bGltPWMoMCw1MDAwMCkpXG5hYmxpbmUoMCwxKSIsInNjdCI6InN1Y2Nlc3NfbXNnKFwiV2hpbGUgVHdlZWRpZSBkaXN0cmlidXRpb24gZW5hYmxlcyB1cyB0byBmaXQgYSBjb21wb3VuZCBsb3NzIGRpc3RyaWJ1dGlvbiBpbiBvbmUgc3RlcCwgYWN0dWFsIGNsYWltcyBkYXRhc2V0IG1pZ2h0IG5vdCBmaXQgaW50byB0aGUgZGlzdHJpYnV0aW9uIGVzcGVjaWFsbHkgd2hlbiB3ZSBvYnNlcnZlIGhlYXZ5LXRhaWwgYmVoYXZpb3IuXCIpIiwiaGludCI6IkZvciBUd2VlZGllIGRpc3RyaWJ1dGlvbiwgd2UgZXN0aW1hdGUgdGhyZWUgcGFyYW1ldGVycyAobXUsIHBoaSwgcCkgdGhhdCBleHBsYWluIHRoZSBvdmVyYWwgbWVhbiwgZGlzcGVyc2lvbiwgYW5kIHNoYXBlIG9mIHRoZSBkaXN0cmlidXRpb24uIn0=
</div>
</div>
</div>
<div id="effects-of-coverage-modifications" class="section level2">
<h2><span class="header-section-number">5.6</span> Effects of Coverage Modifications</h2>
<hr />
<p>In this section, we learn how to:</p>
<ul>
<li>Examine the impact of aggregate deductible on the aggregate loss</li>
<li>Examine the effect of per-occurrence deductible on frequency and severity components in the aggregate loss</li>
</ul>
<hr />
<div id="video-effects-of-coverage-modifications" class="section level4 unnumbered">
<h4>Video: Effects of Coverage Modifications</h4>
<center>
<iframe id="kaltura_player" src="https://cdnapisec.kaltura.com/p/1660902/sp/166090200/embedIframeJs/uiconf_id/25717641/partner_id/1660902?iframeembed=true&amp;playerId=kaltura_player&amp;entry_id=1_ux66n6m1&amp;flashvars[streamerType]=auto&amp;flashvars[localizationCode]=en_US&amp;flashvars[leadWithHTML5]=true&amp;flashvars[sideBarContainer.plugin]=true&amp;flashvars[sideBarContainer.position]=left&amp;flashvars[sideBarContainer.clickToClose]=true&amp;flashvars[chapters.plugin]=true&amp;flashvars[chapters.layout]=vertical&amp;flashvars[chapters.thumbnailRotator]=false&amp;flashvars[streamSelector.plugin]=true&amp;flashvars[EmbedPlayer.SpinnerTarget]=videoHolder&amp;flashvars[dualScreen.plugin]=true&amp;flashvars[Kaltura.addCrossoriginToIframe]=true&amp;&amp;wid=1_t0nnom35" width="649" height="401" allowfullscreen webkitallowfullscreen mozAllowFullScreen allow="autoplay *; fullscreen *; encrypted-media *" frameborder="0" title="Kaltura Player">
</iframe>
</center>
</div>
<div id="overheads-effects-of-coverage-modifications-click-tab-to-view" class="section level4 unnumbered">
<h4>Overheads: Effects of Coverage Modifications (Click Tab to View)</h4>
<div class="tab">
<button class="tablinks" onclick="openTab(event, 'Sect55A')">A. Aggregate Deductible</button>
<button class="tablinks" onclick="openTab(event, 'Sect55B')">B. Per-occurrence Deductible</button>
<button class="tablinks" onclick="openTab(event, 'Sect55C')">C. Per-occurrence Deductible and Frequency</button>
<button class="tablinks" onclick="openTab(event, 'Sect55D')">D. Example</button>
<button class="tablinks" onclick="openTab(event, 'Sect55E')">E. Per-occurrence Deductible</button>
</div>
<div id="Sect55A" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=51" width="100%" height="400"> </iframe>
</div>
<div id="Sect55B" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=53" width="100%" height="400"> </iframe>
</div>
<div id="Sect55C" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=54" width="100%" height="400"> </iframe>
</div>
<div id="Sect55D" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=56" width="100%" height="400"> </iframe>
</div>
<div id="Sect55E" class="tabcontent">
<span class="topright" onclick="this.parentElement.style.display=&#39;none&#39;">Hide</span>
<iframe src="./Overheads/LDA1.Chap5.pdf#page=58" width="100%" height="400"> </iframe>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-selection-and-estimation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
